import{r as h,d as q,b as y,j as e,B as w,s as D}from"./index-wx0cpdQ-.js";import{D as R,f as T,a as E,b as O,c as M}from"./dialog-iH9WTBjz.js";import{I}from"./input-DlubX1PJ.js";import{T as z}from"./textarea-DIE75VUw.js";import{u as F}from"./mobile-DDjMNcjN.js";import{s as o}from"./SupabaseClient-C5AFRzKB.js";import{P as k}from"./plus-Ci3g5hd-.js";const A=async s=>{if(!s.length)return[];try{const{data:t,error:r}=await o.from("meals").select("id, calories").in("id",s);if(r)throw r;return t}catch(t){return console.error("Error getting meal calories:",t),[]}},B=async(s,t)=>{try{const{data:r,error:p}=await o.from("meal_plan_items").select("meal_id").eq("meal_plan_id",s);if(p)throw p;if(!r||r.length===0)return!1;const f=r.map(l=>l.meal_id),i=await A(f);if(!i.length)return!1;const c=i.reduce((l,d)=>l+(d.calories||0),0),g=new Date().toISOString().split("T")[0],{data:n}=await o.from("calorie_records").select("id, calories_consumed").eq("user_id",t).eq("recorded_date",g).maybeSingle();return n?await o.from("calorie_records").update({calories_consumed:n.calories_consumed+c}).eq("id",n.id):await o.from("calorie_records").insert({user_id:t,calories_consumed:c,calories_goal:2e3}),await o.rpc("update_daily_progress",{user_id_param:t}),!0}catch(r){return console.error("Error saving meal plan calories:",r),!1}};function G({onMealPlanCreated:s,buttonText:t="Create Meal Plan",buttonIcon:r=e.jsx(k,{className:"mr-2 h-4 w-4"})}){const[p,f]=h.useState(!1),[i,c]=h.useState(""),[g,n]=h.useState(""),[l,d]=h.useState(!1),{toast:C}=q(),{isMobile:j,isTablet:S}=F(),v=j||S,{language:x}=y(),_={en:{createMealPlan:"Create Meal Plan",planName:"Plan Name",enterPlanName:"Enter plan name",description:"Description",descriptionOptional:"Description (optional)",creating:"Creating...",create:"Create Plan",mealPlanCreated:"Meal Plan Created",mealPlanCreatedDesc:"Your meal plan was successfully created.",authRequired:"Authentication Required",loginRequired:"You must be logged in to create a meal plan.",error:"Error",failedToCreate:"Failed to create meal plan:"},fr:{createMealPlan:"Créer un Plan de Repas",planName:"Nom du Plan",enterPlanName:"Entrez le nom du plan",description:"Description",descriptionOptional:"Description (optionnel)",creating:"Création en cours...",create:"Créer le Plan",mealPlanCreated:"Plan de Repas Créé",mealPlanCreatedDesc:"Votre plan de repas a été créé avec succès.",authRequired:"Authentification Requise",loginRequired:"Vous devez être connecté pour créer un plan de repas.",error:"Erreur",failedToCreate:"Échec de la création du plan de repas:"}},a=_[x]||_.en,N=async m=>{m.preventDefault(),d(!0);try{const{data:{user:u}}=await D.auth.getUser();if(!u){C({title:a.authRequired,description:a.loginRequired,variant:"destructive"}),d(!1);return}const{data:P,error:b}=await D.from("meal_plans").insert([{name:i,description:g,user_id:u.id,created_at:new Date().toISOString()}]).select().single();if(b)throw b;P&&await B(P.id,u.id),C({title:a.mealPlanCreated,description:a.mealPlanCreatedDesc,variant:"default"}),f(!1),c(""),n(""),s==null||s()}catch(u){C({title:a.error,description:a.failedToCreate+" "+u.message,variant:"destructive"})}finally{d(!1)}};return e.jsxs(R,{open:p,onOpenChange:f,children:[e.jsx(T,{asChild:!0,children:e.jsxs(w,{children:[r,v?"":x==="fr"?"Créer un Plan de Repas":t]})}),e.jsxs(E,{className:"sm:max-w-md",children:[e.jsx(O,{children:e.jsx(M,{children:a.createMealPlan})}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"plan-name",className:"block text-sm font-medium mb-1",children:a.planName}),e.jsx(I,{id:"plan-name",placeholder:a.enterPlanName,value:i,onChange:m=>c(m.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"plan-description",className:"block text-sm font-medium mb-1",children:a.description}),e.jsx(z,{id:"plan-description",placeholder:a.descriptionOptional,value:g,onChange:m=>n(m.target.value),rows:3})]}),e.jsx(w,{type:"submit",disabled:l||!i,className:"w-full",children:l?a.creating:a.create})]})]})]})}export{G as C,B as s};
