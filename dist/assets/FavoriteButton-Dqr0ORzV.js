import{J as i,r as f,d as F,j as h,a as _}from"./index-wx0cpdQ-.js";import{s as c}from"./SupabaseClient-C5AFRzKB.js";import{H as b}from"./Combination-C0y2sNL0.js";const w=async a=>{var e;try{const{data:r}=await c.auth.getSession(),s=(e=r.session)==null?void 0:e.user.id;if(!s)return i.error("You must be logged in to add favorites"),null;const{data:o}=await c.from("favorites").select("*").eq("user_id",s).eq("meal_id",a).maybeSingle();if(o)return i.info("This meal is already in your favorites"),o;const{data:t,error:n}=await c.from("favorites").insert({user_id:s,meal_id:a}).select().single();return n?(console.error("Error adding to favorites:",n),i.error("Failed to add to favorites"),null):(i.success("Added to favorites"),t)}catch(r){return console.error("Error adding to favorites:",r),i.error("Failed to add to favorites"),null}},E=async a=>{var e;try{const{data:r}=await c.auth.getSession(),s=(e=r.session)==null?void 0:e.user.id;if(!s)return i.error("You must be logged in to remove favorites"),!1;const{error:o}=await c.from("favorites").delete().eq("id",a).eq("user_id",s);return o?(console.error("Error removing favorite:",o),i.error("Failed to remove from favorites"),!1):!0}catch(r){return console.error("Error removing favorite:",r),i.error("Failed to remove from favorites"),!1}},S=async a=>{var e;try{const{data:r}=await c.auth.getSession(),s=(e=r.session)==null?void 0:e.user.id;if(!s)return!1;const{data:o,error:t}=await c.from("favorites").select("id").eq("user_id",s).eq("meal_id",a).maybeSingle();return t?(console.error("Error checking favorite status:",t),!1):!!o}catch(r){return console.error("Error checking favorite status:",r),!1}},j=async()=>{var a;try{const{data:e}=await c.auth.getSession(),r=(a=e.session)==null?void 0:a.user.id;if(!r)return i.error("You must be logged in to view favorites"),[];const{data:s,error:o}=await c.from("favorites").select(`
        *,
        meal:meals (
          id,
          meal_name,
          image_url,
          category_id,
          subcategory_id,
          meal_categories (name),
          meal_subcategories (name)
        )
      `).eq("user_id",r).order("created_at",{ascending:!1});return o?(console.error("Error fetching favorites:",o),i.error("Failed to load favorites"),[]):s.map(t=>{var n,u;return{id:t.id,meal_id:t.meal_id,created_at:t.created_at,...t.meal,category_name:(n=t.meal.meal_categories)==null?void 0:n.name,subcategory_name:(u=t.meal.meal_subcategories)==null?void 0:u.name}})}catch(e){return console.error("Error fetching favorites:",e),i.error("Failed to load favorites"),[]}};function A({mealId:a,favoriteId:e,className:r,size:s=20,onToggle:o}){const[t,n]=f.useState(!!e),[u,m]=f.useState(!1),[g,y]=f.useState(e),{toast:l}=F();f.useEffect(()=>{(async()=>{if(!e){const d=await S(a);n(d)}})()},[a,e]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),!u){m(!0);try{if(t)g&&await E(g)&&(n(!1),y(void 0),l({title:"Removed from favorites",description:"This meal has been removed from your favorites"}),o&&o(!1));else{const d=await w(a);d&&(n(!0),y(d.id),l({title:"Added to favorites",description:"This meal has been added to your favorites"}),o&&o(!0))}}catch(d){console.error("Error toggling favorite:",d),l({title:"Error",description:"There was a problem updating your favorites",variant:"destructive"})}finally{m(!1)}}};return h.jsx("button",{onClick:p,disabled:u,className:_("transition-all duration-200 ease-in-out","hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2","rounded-full p-1.5",t?"text-red-500":"text-gray-400 hover:text-red-500",u&&"opacity-50 cursor-not-allowed",r),"aria-label":t?"Remove from favorites":"Add to favorites",children:h.jsx(b,{className:_("transition-transform duration-300",t&&"fill-current animate-pulse"),size:s})})}export{A as F,w as a,j as g,S as i,E as r};
