import{R as j,y as H,r as T,b as me,j as d,B as fe,s as J,J as Y}from"./index-wx0cpdQ-.js";import{C as ve,a as pe,b as he,d as ge,e as be}from"./card-Ks5reE5D.js";import{C as Ae}from"./chart-pie-Bs8iT_Ce.js";import{m as ye}from"./ProfileSidebar-CUX9nyIG.js";import{i as B,E as xe,n as Se,f as $,p as Z,e as F,L as M,g as D,q as Pe,X as Re,A as je,o as Ie,b as ae,c as _e,j as k,r as Ne,d as we,G as Ee,C as Oe,Y as Ce,Z as q,y as ne,m as U,I as Te,_ as oe,N as De,S as ke,U as Le,V as Fe,R as Ke,W as Be,T as Me}from"./RewardSystem-Dmx-RgDF.js";import{S as Ve}from"./save-Cw9tneAB.js";var W;function K(n){"@babel/helpers - typeof";return K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},K(n)}function L(){return L=Object.assign?Object.assign.bind():function(n){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n},L.apply(this,arguments)}function re(n,a){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);a&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,e)}return r}function v(n){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?re(Object(r),!0).forEach(function(e){_(n,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function Ge(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}function ie(n,a){for(var r=0;r<a.length;r++){var e=a[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,ce(e.key),e)}}function qe(n,a,r){return a&&ie(n.prototype,a),r&&ie(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function $e(n,a,r){return a=z(a),Ue(n,le()?Reflect.construct(a,r||[],z(n).constructor):a.apply(n,r))}function Ue(n,a){if(a&&(K(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return We(n)}function We(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function le(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(le=function(){return!!n})()}function z(n){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},z(n)}function ze(n,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),a&&X(n,a)}function X(n,a){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},X(n,a)}function _(n,a,r){return a=ce(a),a in n?Object.defineProperty(n,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[a]=r,n}function ce(n){var a=He(n,"string");return K(a)=="symbol"?a:a+""}function He(n,a){if(K(n)!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var e=r.call(n,a||"default");if(K(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}var E=function(n){function a(r){var e;return Ge(this,a),e=$e(this,a,[r]),_(e,"pieRef",null),_(e,"sectorRefs",[]),_(e,"id",Te("recharts-pie-")),_(e,"handleAnimationEnd",function(){var t=e.props.onAnimationEnd;e.setState({isAnimationFinished:!0}),B(t)&&t()}),_(e,"handleAnimationStart",function(){var t=e.props.onAnimationStart;e.setState({isAnimationFinished:!1}),B(t)&&t()}),e.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},e}return ze(a,n),qe(a,[{key:"isActiveIndex",value:function(e){var t=this.props.activeIndex;return Array.isArray(t)?t.indexOf(e)!==-1:e===t}},{key:"hasActiveIndex",value:function(){var e=this.props.activeIndex;return Array.isArray(e)?e.length!==0:e||e===0}},{key:"renderLabels",value:function(e){var t=this.props.isAnimationActive;if(t&&!this.state.isAnimationFinished)return null;var s=this.props,o=s.label,p=s.labelLine,i=s.dataKey,l=s.valueKey,S=$(this.props,!1),u=$(o,!1),m=$(p,!1),y=o&&o.offsetRadius||20,f=e.map(function(c,g){var h=(c.startAngle+c.endAngle)/2,b=Z(c.cx,c.cy,c.outerRadius+y,h),x=v(v(v(v({},S),c),{},{stroke:"none"},u),{},{index:g,textAnchor:a.getTextAnchor(b.x,c.cx)},b),I=v(v(v(v({},S),c),{},{fill:"none",stroke:c.fill},m),{},{index:g,points:[Z(c.cx,c.cy,c.outerRadius,h),b]}),P=i;return F(i)&&F(l)?P="value":F(i)&&(P=l),j.createElement(M,{key:"label-".concat(c.startAngle,"-").concat(c.endAngle,"-").concat(c.midAngle,"-").concat(g)},p&&a.renderLabelLineItem(p,I,"line"),a.renderLabelItem(o,x,D(c,P)))});return j.createElement(M,{className:"recharts-pie-labels"},f)}},{key:"renderSectorsStatically",value:function(e){var t=this,s=this.props,o=s.activeShape,p=s.blendStroke,i=s.inactiveShape;return e.map(function(l,S){if((l==null?void 0:l.startAngle)===0&&(l==null?void 0:l.endAngle)===0&&e.length!==1)return null;var u=t.isActiveIndex(S),m=i&&t.hasActiveIndex()?i:null,y=u?o:m,f=v(v({},l),{},{stroke:p?l.fill:l.stroke,tabIndex:-1});return j.createElement(M,L({ref:function(g){g&&!t.sectorRefs.includes(g)&&t.sectorRefs.push(g)},tabIndex:-1,className:"recharts-pie-sector"},Pe(t.props,l,S),{key:"sector-".concat(l==null?void 0:l.startAngle,"-").concat(l==null?void 0:l.endAngle,"-").concat(l.midAngle,"-").concat(S)}),j.createElement(Re,L({option:y,isActive:u,shapeType:"sector"},f)))})}},{key:"renderSectorsWithAnimation",value:function(){var e=this,t=this.props,s=t.sectors,o=t.isAnimationActive,p=t.animationBegin,i=t.animationDuration,l=t.animationEasing,S=t.animationId,u=this.state,m=u.prevSectors,y=u.prevIsAnimationActive;return j.createElement(je,{begin:p,duration:i,isActive:o,easing:l,from:{t:0},to:{t:1},key:"pie-".concat(S,"-").concat(y),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(f){var c=f.t,g=[],h=s&&s[0],b=h.startAngle;return s.forEach(function(x,I){var P=m&&m[I],R=I>0?Ie(x,"paddingAngle",0):0;if(P){var w=ae(P.endAngle-P.startAngle,x.endAngle-x.startAngle),A=v(v({},x),{},{startAngle:b+R,endAngle:b+w(c)+R});g.push(A),b=A.endAngle}else{var C=x.endAngle,N=x.startAngle,V=ae(0,C-N),G=V(c),O=v(v({},x),{},{startAngle:b+R,endAngle:b+G+R});g.push(O),b=O.endAngle}}),j.createElement(M,null,e.renderSectorsStatically(g))})}},{key:"attachKeyboardHandlers",value:function(e){var t=this;e.onkeydown=function(s){if(!s.altKey)switch(s.key){case"ArrowLeft":{var o=++t.state.sectorToFocus%t.sectorRefs.length;t.sectorRefs[o].focus(),t.setState({sectorToFocus:o});break}case"ArrowRight":{var p=--t.state.sectorToFocus<0?t.sectorRefs.length-1:t.state.sectorToFocus%t.sectorRefs.length;t.sectorRefs[p].focus(),t.setState({sectorToFocus:p});break}case"Escape":{t.sectorRefs[t.state.sectorToFocus].blur(),t.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var e=this.props,t=e.sectors,s=e.isAnimationActive,o=this.state.prevSectors;return s&&t&&t.length&&(!o||!_e(o,t))?this.renderSectorsWithAnimation():this.renderSectorsStatically(t)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var e=this,t=this.props,s=t.hide,o=t.sectors,p=t.className,i=t.label,l=t.cx,S=t.cy,u=t.innerRadius,m=t.outerRadius,y=t.isAnimationActive,f=this.state.isAnimationFinished;if(s||!o||!o.length||!k(l)||!k(S)||!k(u)||!k(m))return null;var c=H("recharts-pie",p);return j.createElement(M,{tabIndex:this.props.rootTabIndex,className:c,ref:function(h){e.pieRef=h}},this.renderSectors(),i&&this.renderLabels(o),Ne.renderCallByParent(this.props,null,!1),(!y||f)&&we.renderCallByParent(this.props,o,!1))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t.prevIsAnimationActive!==e.isAnimationActive?{prevIsAnimationActive:e.isAnimationActive,prevAnimationId:e.animationId,curSectors:e.sectors,prevSectors:[],isAnimationFinished:!0}:e.isAnimationActive&&e.animationId!==t.prevAnimationId?{prevAnimationId:e.animationId,curSectors:e.sectors,prevSectors:t.curSectors,isAnimationFinished:!0}:e.sectors!==t.curSectors?{curSectors:e.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(e,t){return e>t?"start":e<t?"end":"middle"}},{key:"renderLabelLineItem",value:function(e,t,s){if(j.isValidElement(e))return j.cloneElement(e,t);if(B(e))return e(t);var o=H("recharts-pie-label-line",typeof e!="boolean"?e.className:"");return j.createElement(xe,L({},t,{key:s,type:"linear",className:o}))}},{key:"renderLabelItem",value:function(e,t,s){if(j.isValidElement(e))return j.cloneElement(e,t);var o=s;if(B(e)&&(o=e(t),j.isValidElement(o)))return o;var p=H("recharts-pie-label-text",typeof e!="boolean"&&!B(e)?e.className:"");return j.createElement(Se,L({},t,{alignmentBaseline:"middle",className:p}),o)}}])}(T.PureComponent);W=E;_(E,"displayName","Pie");_(E,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Ee.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});_(E,"parseDeltaAngle",function(n,a){var r=U(a-n),e=Math.min(Math.abs(a-n),360);return r*e});_(E,"getRealPieData",function(n){var a=n.data,r=n.children,e=$(n,!1),t=Oe(r,oe);return a&&a.length?a.map(function(s,o){return v(v(v({payload:s},e),s),t&&t[o]&&t[o].props)}):t&&t.length?t.map(function(s){return v(v({},e),s.props)}):[]});_(E,"parseCoordinateOfPie",function(n,a){var r=a.top,e=a.left,t=a.width,s=a.height,o=Ce(t,s),p=e+q(n.cx,t,t/2),i=r+q(n.cy,s,s/2),l=q(n.innerRadius,o,0),S=q(n.outerRadius,o,o*.8),u=n.maxRadius||Math.sqrt(t*t+s*s)/2;return{cx:p,cy:i,innerRadius:l,outerRadius:S,maxRadius:u}});_(E,"getComposedData",function(n){var a=n.item,r=n.offset,e=a.type.defaultProps!==void 0?v(v({},a.type.defaultProps),a.props):a.props,t=W.getRealPieData(e);if(!t||!t.length)return null;var s=e.cornerRadius,o=e.startAngle,p=e.endAngle,i=e.paddingAngle,l=e.dataKey,S=e.nameKey,u=e.valueKey,m=e.tooltipType,y=Math.abs(e.minAngle),f=W.parseCoordinateOfPie(e,r),c=W.parseDeltaAngle(o,p),g=Math.abs(c),h=l;F(l)&&F(u)?(ne(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),h="value"):F(l)&&(ne(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),h=u);var b=t.filter(function(A){return D(A,h,0)!==0}).length,x=(g>=360?b:b-1)*i,I=g-b*y-x,P=t.reduce(function(A,C){var N=D(C,h,0);return A+(k(N)?N:0)},0),R;if(P>0){var w;R=t.map(function(A,C){var N=D(A,h,0),V=D(A,S,C),G=(k(N)?N:0)/P,O;C?O=w.endAngle+U(c)*i*(N!==0?1:0):O=o;var Q=O+U(c)*((N!==0?y:0)+G*I),ee=(O+Q)/2,te=(f.innerRadius+f.outerRadius)/2,ue=[{name:V,value:N,payload:A,dataKey:h,type:m}],de=Z(f.cx,f.cy,te,ee);return w=v(v(v({percent:G,cornerRadius:s,name:V,tooltipPayload:ue,midAngle:ee,middleRadius:te,tooltipPosition:de},A),f),{},{value:D(A,h),startAngle:O,endAngle:Q,payload:A,paddingAngle:U(c)*i}),w})}return v(v({},f),{},{sectors:R,data:t})});var Je=De({chartName:"PieChart",GraphicalChild:E,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:ke},{axisType:"radiusAxis",AxisComp:Le}],formatAxisMap:Fe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const Ye=[{name:"Proteins",value:25,color:"#10B981"},{name:"Carbs",value:45,color:"#F59E0B"},{name:"Fats",value:30,color:"#3B82F6"}],se=Math.PI/180,Ze=({cx:n,cy:a,midAngle:r,innerRadius:e,outerRadius:t,percent:s,index:o})=>{const p=e+(t-e)*.5,i=n+p*Math.cos(-r*se),l=a+p*Math.sin(-r*se);return d.jsx("text",{x:i,y:l,fill:"white",textAnchor:i>n?"start":"end",dominantBaseline:"central",children:`${(s*100).toFixed(0)}%`})},rt=()=>{const[n,a]=T.useState(Ye),[r,e]=T.useState(!1),[t,s]=T.useState(null),{language:o}=me(),p={en:{title:"Nutrition Balance",proteins:"Proteins",carbs:"Carbohydrates",fats:"Fats",save:"Save Progress",saved:"Progress saved!",recommendedValues:"Recommended Values",yourIntake:"Your Intake",balanced:"Well Balanced!",needsImprovement:"Needs Improvement",increasing:"Increasing",decreasing:"Decreasing"},fr:{title:"Équilibre Nutritionnel",proteins:"Protéines",carbs:"Glucides",fats:"Lipides",save:"Sauvegarder",saved:"Progrès sauvegardé !",recommendedValues:"Valeurs Recommandées",yourIntake:"Votre Consommation",balanced:"Bien Équilibré !",needsImprovement:"À Améliorer",increasing:"En Augmentation",decreasing:"En Diminution"}},i=p[o]||p.en;T.useEffect(()=>{a(u=>u.map(m=>({...m,name:m.name==="Proteins"?i.proteins:m.name==="Carbs"?i.carbs:i.fats})))},[o,i.proteins,i.carbs,i.fats]),T.useEffect(()=>{(async()=>{const{data:{session:m}}=await J.auth.getSession();if(m){s(m.user.id);const y=new Date().toISOString().split("T")[0],{data:f,error:c}=await J.from("calorie_records").select("protein_grams, carbs_grams, fat_grams").eq("user_id",m.user.id).eq("recorded_date",y).order("created_at",{ascending:!1}).limit(1);if(f&&f.length>0){const g=f[0].protein_grams||0,h=f[0].carbs_grams||0,b=f[0].fat_grams||0,x=g*4,I=h*4,P=b*9,R=x+I+P;if(R>0){const w=[{name:i.proteins,value:Math.round(x/R*100),color:"#10B981"},{name:i.carbs,value:Math.round(I/R*100),color:"#F59E0B"},{name:i.fats,value:Math.round(P/R*100),color:"#3B82F6"}];a(w)}}}})()},[i.proteins,i.carbs,i.fats]);const l=async()=>{var u,m,y;if(!t){Y.error("Please sign in to save your progress");return}try{const c=((u=n.find(A=>A.name===i.proteins))==null?void 0:u.value)||0,g=((m=n.find(A=>A.name===i.carbs))==null?void 0:m.value)||0,h=((y=n.find(A=>A.name===i.fats))==null?void 0:y.value)||0,b=c/100*2e3,x=g/100*2e3,I=h/100*2e3,P=Math.round(b/4),R=Math.round(x/4),w=Math.round(I/9);await J.from("calorie_records").insert({user_id:t,protein_grams:P,carbs_grams:R,fat_grams:w,calories_consumed:Math.round(b+x+I),calories_goal:2e3}),Y.success(i.saved),e(!0),setTimeout(()=>e(!1),1e3)}catch(f){console.error("Error saving nutrition data:",f),Y.error("Failed to save progress")}},S=()=>{var f,c,g;const u=((f=n.find(h=>h.name===i.proteins))==null?void 0:f.value)||0,m=((c=n.find(h=>h.name===i.carbs))==null?void 0:c.value)||0,y=((g=n.find(h=>h.name===i.fats))==null?void 0:g.value)||0;return u>=20&&u<=35&&m>=40&&m<=60&&y>=20&&y<=35};return d.jsxs(ve,{className:"w-full h-full",children:[d.jsxs(pe,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[d.jsxs(he,{className:"text-md font-medium flex items-center",children:[d.jsx(Ae,{className:"mr-2 h-5 w-5 text-purple-500"}),i.title]}),S()?d.jsx("div",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:i.balanced}):d.jsx("div",{className:"px-2 py-1 bg-amber-100 text-amber-800 text-xs rounded-full",children:i.needsImprovement})]}),d.jsxs(ge,{className:"pt-3",children:[d.jsx(ye.div,{animate:r?{rotate:360}:{rotate:0},transition:{duration:.5},className:"h-56 sm:h-64",children:d.jsx(Ke,{width:"100%",height:"100%",children:d.jsxs(Je,{children:[d.jsx(E,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:Ze,outerRadius:80,fill:"#8884d8",dataKey:"value",animationDuration:1e3,animationBegin:0,animationEasing:"ease-out",children:n.map((u,m)=>d.jsx(oe,{fill:u.color},`cell-${m}`))}),d.jsx(Be,{layout:"horizontal",verticalAlign:"bottom",align:"center"}),d.jsx(Me,{})]})})}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("div",{className:"text-sm font-medium mb-2",children:[i.recommendedValues,":"]}),d.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs text-center",children:[d.jsxs("div",{className:"p-2 rounded-md bg-green-100 text-green-800",children:[i.proteins,": 20-35%"]}),d.jsxs("div",{className:"p-2 rounded-md bg-amber-100 text-amber-800",children:[i.carbs,": 45-65%"]}),d.jsxs("div",{className:"p-2 rounded-md bg-blue-100 text-blue-800",children:[i.fats,": 20-35%"]})]}),d.jsx("div",{className:"flex items-center justify-between mt-4",children:n.map((u,m)=>d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("div",{className:"w-3 h-3 rounded-full mb-1",style:{backgroundColor:u.color}}),d.jsx("div",{className:"text-xs font-medium",children:u.name}),d.jsxs("div",{className:"text-xs",children:[u.value,"%"]})]},m))})]})]}),d.jsx(be,{children:d.jsxs(fe,{onClick:l,className:"w-full",variant:"default",size:"sm",children:[d.jsx(Ve,{className:"mr-1 h-4 w-4"}),i.save]})})]})};export{rt as N};
