import{c as W,u as $,d as B,r as d,s as o,j as a}from"./index-wx0cpdQ-.js";import{C as b}from"./CreateMealPlanDialog--_NKnQ5O.js";import{A as K}from"./AddToMealPlanDialog-Bo0LErG5.js";import{P as E,C as U}from"./ProfileSidebar-CUX9nyIG.js";import{C as Y}from"./chevron-left-CyC_tzUw.js";import{C as G}from"./chevron-right-CoqZHP9k.js";import{T as w}from"./trash-2-Cdi4lUr4.js";import"./dialog-iH9WTBjz.js";import"./index-CjjoUzqA.js";import"./Combination-C0y2sNL0.js";import"./input-DlubX1PJ.js";import"./textarea-DIE75VUw.js";import"./mobile-DDjMNcjN.js";import"./SupabaseClient-C5AFRzKB.js";import"./plus-Ci3g5hd-.js";import"./select-Dvj3AB60.js";import"./index-Cs8e_-Nm.js";import"./chevron-down-ChOtW655.js";import"./search-C5ZZVUmr.js";import"./Logo-HzuToWv5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=W("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),J=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],S=["Breakfast","Lunch","Dinner","Snack"],fe=()=>{const k=$(),{toast:n}=B(),[i,u]=d.useState([]),[l,c]=d.useState(null),[F,j]=d.useState([]),[T,g]=d.useState(!0),[h,N]=d.useState(null),[p,x]=d.useState(""),[f,v]=d.useState("");d.useEffect(()=>{P()},[]),d.useEffect(()=>{l&&y(l)},[l]);const P=async()=>{try{const{data:{user:e}}=await o.auth.getUser();if(!e){n({title:"Authentication Required",description:"Please log in to view your meal plans",variant:"destructive"}),k("/login");return}g(!0);const{data:t,error:s}=await o.from("meal_plans").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(s)throw s;t&&t.length>0?(u(t),c(t[0].id)):(u([]),c(null))}catch(e){n({title:"Error",description:"Failed to load meal plans: "+e.message,variant:"destructive"})}finally{g(!1)}},y=async e=>{try{const{data:t,error:s}=await o.from("meal_plan_items").select(`
          id,
          meal_plan_id,
          meal_id,
          day_of_week,
          meal_time,
          meal:meals (
            id,
            meal_name,
            image_url
          )
        `).eq("meal_plan_id",e);if(s)throw s;j(t||[])}catch(t){n({title:"Error",description:"Failed to load meal plan items: "+t.message,variant:"destructive"})}},A=e=>{N(e),x(e.name),v(e.description||"")},_=()=>{N(null),x(""),v("")},D=async()=>{if(!(!h||!p.trim()))try{const{error:e}=await o.from("meal_plans").update({name:p,description:f}).eq("id",h.id);if(e)throw e;n({title:"Success",description:"Meal plan updated successfully"}),u(t=>t.map(s=>s.id===h.id?{...s,name:p,description:f}:s)),_()}catch(e){n({title:"Error",description:"Failed to update meal plan: "+e.message,variant:"destructive"})}},q=async e=>{if(confirm("Are you sure you want to delete this meal plan?"))try{const{error:t}=await o.from("meal_plan_items").delete().eq("meal_plan_id",e);if(t)throw t;const{error:s}=await o.from("meal_plans").delete().eq("id",e);if(s)throw s;if(n({title:"Success",description:"Meal plan deleted successfully"}),u(r=>r.filter(m=>m.id!==e)),l===e){const r=i.filter(m=>m.id!==e);c(r.length>0?r[0].id:null)}}catch(t){n({title:"Error",description:"Failed to delete meal plan: "+t.message,variant:"destructive"})}},z=async e=>{try{const{error:t}=await o.from("meal_plan_items").delete().eq("id",e);if(t)throw t;n({title:"Success",description:"Meal removed from plan"}),j(s=>s.filter(r=>r.id!==e))}catch(t){n({title:"Error",description:"Failed to remove meal from plan: "+t.message,variant:"destructive"})}},I=(e,t)=>F.filter(s=>s.day_of_week===e&&s.meal_time===t),M=()=>{P()},L=()=>{l&&y(l)},R=()=>{if(!l||i.length<=1)return;const e=i.findIndex(t=>t.id===l);e>0&&c(i[e-1].id)},O=()=>{if(!l||i.length<=1)return;const e=i.findIndex(t=>t.id===l);e<i.length-1&&c(i[e+1].id)};return T?a.jsxs("div",{className:"page-container",children:[a.jsx(E,{}),a.jsx("div",{className:"content-area",children:a.jsx("p",{children:"Loading meal plans..."})})]}):a.jsxs("div",{className:"page-container",children:[a.jsx(E,{}),a.jsx("div",{className:"content-area",children:a.jsxs("div",{className:"meal-plan-page",children:[a.jsxs("div",{className:"page-header",children:[a.jsx("h1",{children:"Meal Plans"}),a.jsx("div",{className:"header-actions",children:a.jsx(b,{onMealPlanCreated:M})})]}),h&&a.jsxs("div",{className:"edit-plan-form text-gray-700 dark:text-gray-100",children:[a.jsx("h2",{children:"Edit Meal Plan"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"edit-plan-name",children:"Plan Name"}),a.jsx("input",{id:"edit-plan-name",type:"text",value:p,onChange:e=>x(e.target.value),placeholder:"Plan name"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"edit-plan-description",children:"Description (Optional)"}),a.jsx("textarea",{id:"edit-plan-description",value:f,onChange:e=>v(e.target.value),placeholder:"Plan description"})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"cancel-button",onClick:_,children:"Cancel"}),a.jsx("button",{className:"save-button",onClick:D,disabled:!p.trim(),children:"Save Changes"})]})]}),i.length>0?a.jsxs("div",{className:"meal-plan-content",children:[a.jsxs("div",{className:"plan-selector",children:[a.jsx("button",{className:"nav-button",onClick:R,disabled:i.findIndex(e=>e.id===l)<=0,children:a.jsx(Y,{size:18})}),a.jsx("select",{value:l||"",onChange:e=>c(e.target.value),children:i.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))}),a.jsx("button",{className:"nav-button",onClick:O,disabled:i.findIndex(e=>e.id===l)>=i.length-1,children:a.jsx(G,{size:18})}),a.jsxs("div",{className:"plan-actions",children:[a.jsx("button",{className:"edit-button",onClick:()=>{const e=i.find(t=>t.id===l);e&&A(e)},children:a.jsx(H,{size:16})}),a.jsx("button",{className:"delete-button",onClick:()=>l&&q(l),children:a.jsx(w,{size:16})})]})]}),a.jsxs("div",{className:"meal-plan-grid text-gray-700 dark:text-gray-100",children:[a.jsxs("div",{className:"meal-times-header",children:[a.jsx("div",{className:"empty-cell"}),S.map(e=>a.jsx("div",{className:"meal-time-cell",children:e},e))]}),J.map(e=>a.jsxs("div",{className:"day-row",children:[a.jsx("div",{className:"day-cell",children:e}),S.map(t=>a.jsxs("div",{className:"meal-cell",children:[I(e,t).map(s=>{var r,m,C;return a.jsxs("div",{className:"meal-item",children:[a.jsx("img",{src:((r=s.meal)==null?void 0:r.image_url)||"/placeholder-meal.jpg",alt:(m=s.meal)==null?void 0:m.meal_name}),a.jsxs("div",{className:"meal-item-content",children:[a.jsx("span",{className:"meal-name",children:(C=s.meal)==null?void 0:C.meal_name}),a.jsx("button",{className:"remove-meal",onClick:()=>z(s.id),"aria-label":"Remove meal",children:a.jsx(w,{size:14})})]})]},s.id)}),l&&a.jsx(K,{planId:l,dayOfWeek:e,mealTime:t,onMealAdded:L})]},`${e}-${t}`))]},e))]})]}):a.jsxs("div",{className:"no-meal-plans",children:[a.jsx(U,{size:48}),a.jsx("h2",{children:"No meal plans yet"}),a.jsx("p",{children:"Create your first meal plan to get started."}),a.jsx(b,{onMealPlanCreated:M})]})]})})]})};export{fe as default};
