import{c as O,s as W,r as l,b as F,j as e,B as U,J as Q,A as Ce,P as se,N as Se,H as de,a as te}from"./index-wx0cpdQ-.js";import{C as $,a as I,b as B,d as z,e as ue}from"./card-Ks5reE5D.js";import{T as _e,a as V,b as Y}from"./tabs-kHd3UHHY.js";import{S as qe}from"./scrollable-tabs-De-o2eb7.js";import{S as le,P as me}from"./Confetti-EdMnZRZX.js";import{s as _}from"./SupabaseClient-C5AFRzKB.js";import{m as D,A as ae,T as G,C as De,S as Me,L as Ae,G as Ee,P as Te}from"./ProfileSidebar-CUX9nyIG.js";import{a as Le}from"./RewardSystem-Dmx-RgDF.js";import{N as Pe}from"./NutritionProgressWheel-Dkyf5HFB.js";import{S as Qe,a as Re,b as Ue,c as Fe,d as $e}from"./select-Dvj3AB60.js";import{b as Ie}from"./mealService-nWoNWhtW.js";import{u as he}from"./mobile-DDjMNcjN.js";import{I as Be}from"./input-DlubX1PJ.js";import{C as ze}from"./checkbox-9RmuQjIw.js";import{g as Ve,c as Ye,a as He,C as xe}from"./challengeService-BX7-uLBl.js";import{P as Oe}from"./plus-Ci3g5hd-.js";import{T as pe,U as Ge}from"./users-CX37vi_v.js";import{C as Z}from"./Combination-C0y2sNL0.js";import{F as We}from"./flame-NaXfIesf.js";import{A as Je}from"./award-DAs12a83.js";import"./index-DgvYHQCl.js";import"./index-CjjoUzqA.js";import"./chevron-left-CyC_tzUw.js";import"./chevron-right-CoqZHP9k.js";import"./index-Cs8e_-Nm.js";import"./Logo-HzuToWv5.js";import"./chart-pie-Bs8iT_Ce.js";import"./save-Cw9tneAB.js";import"./chevron-down-ChOtW655.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=O("Badge",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=O("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=O("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=O("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=O("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),ss=async s=>{const{data:a,error:t}=await W.from("meal_moods").insert({user_id:s.user_id,meal_id:s.meal_id,meal_name:s.meal_name,mood:s.mood,notes:s.notes}).select().single();if(t)throw console.error("Error saving meal mood:",t),t;return a},ts=async(s,a=10)=>{const{data:t,error:r}=await W.from("meal_moods").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(a);if(r)throw console.error("Error fetching meal moods:",r),r;return t},J=[{emoji:"ðŸ˜‹",label:"Delicious",value:"delicious"},{emoji:"ðŸ˜Š",label:"Satisfied",value:"satisfied"},{emoji:"ðŸ˜",label:"Neutral",value:"neutral"},{emoji:"ðŸ˜ž",label:"Disappointed",value:"disappointed"},{emoji:"ðŸ˜–",label:"Uncomfortable",value:"uncomfortable"}],as=()=>{const[s,a]=l.useState([]),[t,r]=l.useState(""),[n,d]=l.useState(""),[u,g]=l.useState(""),[v,f]=l.useState([]),[q,y]=l.useState(!1),[C,M]=l.useState(null),[N,m]=l.useState(!1),{language:p}=F();he();const b={en:{title:"Meal Mood Tracker",selectMeal:"Select a meal",howDidYouFeel:"How did you feel after this meal?",notes:"Notes (optional)",submit:"Save Mood",submitting:"Saving...",recentMoods:"Your Recent Moods",noMoods:"No mood entries yet. Start tracking how you feel after meals!",moodSaved:"Your mood has been saved!",selectMoodFirst:"Please select a mood first",selectMealFirst:"Please select a meal first"},fr:{title:"Suivi d'Humeur des Repas",selectMeal:"SÃ©lectionner un repas",howDidYouFeel:"Comment vous Ãªtes-vous senti aprÃ¨s ce repas?",notes:"Notes (optionnel)",submit:"Enregistrer l'Humeur",submitting:"Enregistrement...",recentMoods:"Vos Humeurs RÃ©centes",noMoods:"Pas encore d'entrÃ©es d'humeur. Commencez Ã  suivre comment vous vous sentez aprÃ¨s les repas!",moodSaved:"Votre humeur a Ã©tÃ© enregistrÃ©e!",selectMoodFirst:"Veuillez d'abord sÃ©lectionner une humeur",selectMealFirst:"Veuillez d'abord sÃ©lectionner un repas"}},i=b[p]||b.en;l.useEffect(()=>{(async()=>{y(!0);try{const{data:{session:x}}=await W.auth.getSession();x&&(M(x.user.id),await T(),await h(x.user.id))}catch(x){console.error("Error loading user data:",x)}finally{y(!1)}})()},[]);const T=async()=>{try{const o=await Ie();a(o)}catch(o){console.error("Error loading meals:",o)}},h=async o=>{try{const x=await ts(o);f(x)}catch(x){console.error("Error loading mood entries:",x)}},w=async()=>{var o;if(!t){Q.error(i.selectMealFirst);return}if(!n){Q.error(i.selectMoodFirst);return}if(C){m(!0);try{const x=((o=s.find(P=>P.id===t))==null?void 0:o.meal_name)||"";await ss({user_id:C,meal_id:t,meal_name:x,mood:n,notes:u||null}),new Audio("/sounds/success.mp3").play().catch(P=>console.log("Audio play failed:",P)),Q.success(i.moodSaved),r(""),d(""),g(""),await h(C)}catch(x){console.error("Error saving mood:",x),Q.error("Failed to save mood")}finally{m(!1)}}},A=o=>{var x;return((x=J.find(k=>k.value===o))==null?void 0:x.emoji)||"ðŸ˜"},S=o=>{var x;return((x=J.find(k=>k.value===o))==null?void 0:x.label)||"Neutral"},L=o=>new Date(o).toLocaleDateString(p==="fr"?"fr-FR":"en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs($,{className:"w-full",children:[e.jsx(I,{children:e.jsxs(B,{className:"flex items-center text-lg font-medium",children:[e.jsx("span",{role:"img","aria-label":"mood",className:"mr-2 text-xl",children:"ðŸ˜‹"}),i.title]})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:i.selectMeal}),e.jsxs(Qe,{value:t,onValueChange:r,children:[e.jsx(Re,{children:e.jsx(Ue,{placeholder:i.selectMeal})}),e.jsx(Fe,{children:s.map(o=>e.jsx($e,{value:o.id,children:o.meal_name},o.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-small",children:i.howDidYouFeel}),e.jsx("div",{className:"flex",children:J.map(o=>e.jsxs(D.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>d(o.value),className:`flex flex-col items-center p-1 rounded-md ${n===o.value?"bg-primary/20 ring-2 ring-primary":"hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:[e.jsx("span",{role:"img","aria-label":o.label,className:"text-2xl",children:o.emoji}),e.jsx("span",{className:"text-xs mt-1",children:o.label})]},o.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"notes",className:"text-sm font-medium",children:i.notes}),e.jsx("textarea",{id:"notes",value:u,onChange:o=>g(o.target.value),className:"w-full p-2 border rounded-md h-20 resize-none",placeholder:"How did the meal make you feel? Any digestive issues?"})]}),e.jsx(U,{onClick:w,disabled:N,className:"w-full",children:N?i.submitting:i.submit})]}),e.jsxs(ue,{className:"flex flex-col items-start",children:[e.jsx("h3",{className:"text-md font-medium mb-2",children:i.recentMoods}),v.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:i.noMoods}):e.jsx("div",{className:"w-full space-y-2",children:e.jsx(ae,{children:v.slice(0,5).map(o=>e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"flex items-center p-2 border rounded-md",children:[e.jsx("div",{className:"text-2xl mr-3",children:A(o.mood)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:o.meal_name}),e.jsx("div",{className:"text-xs text-gray-500",children:L(o.created_at)}),o.notes&&e.jsx("div",{className:"text-sm mt-1",children:o.notes})]}),e.jsx("div",{className:"text-sm font-medium",children:S(o.mood)})]},o.id))})})]})]})},ie=[{id:"water",label:"Water Intake",icon:"ðŸ’§",description:"Drink more water daily"},{id:"vegetables",label:"Vegetable Servings",icon:"ðŸ¥¦",description:"Eat more vegetables"},{id:"protein",label:"Protein Intake",icon:"ðŸ¥©",description:"Increase protein consumption"},{id:"sugar",label:"Sugar Reduction",icon:"ðŸ¬",description:"Reduce sugar intake"},{id:"meal_prep",label:"Meal Preparation",icon:"ðŸ±",description:"Prepare meals in advance"},{id:"snacking",label:"Healthy Snacking",icon:"ðŸŽ",description:"Choose healthier snacks"}],rs=()=>{const[s,a]=l.useState(!1),[t,r]=l.useState(""),[n,d]=l.useState([]),[u,g]=l.useState(7),[v,f]=l.useState(5),[q,y]=l.useState([]),[C,M]=l.useState({}),[N,m]=l.useState(null),[p,b]=l.useState(!1),{language:i}=F(),T={en:{title:"Nutrition Challenges",createChallenge:"Create Challenge",challengeName:"Challenge Name",challengeTypes:"Challenge Types",duration:"Duration (days)",difficulty:"Difficulty Level",easy:"Easy",hard:"Hard",create:"Create Challenge",creating:"Creating...",cancel:"Cancel",activeChallenges:"Active Challenges",noChallenges:"No active challenges. Create one to get started!",daysLeft:"days left",day:"day",days:"days",markComplete:"Mark Today Complete",completed:"Completed Today",progress:"Progress",challengeCreated:"Challenge created successfully!",taskCompleted:"Task completed for today!",deleteChallenge:"Delete Challenge"},fr:{title:"DÃ©fis Nutritionnels",createChallenge:"CrÃ©er un DÃ©fi",challengeName:"Nom du DÃ©fi",challengeTypes:"Types de DÃ©fi",duration:"DurÃ©e (jours)",difficulty:"Niveau de DifficultÃ©",easy:"Facile",hard:"Difficile",create:"CrÃ©er le DÃ©fi",creating:"CrÃ©ation...",cancel:"Annuler",activeChallenges:"DÃ©fis Actifs",noChallenges:"Pas de dÃ©fis actifs. CrÃ©ez-en un pour commencer!",daysLeft:"jours restants",day:"jour",days:"jours",markComplete:"Marquer Aujourd'hui Complet",completed:"ComplÃ©tÃ© Aujourd'hui",progress:"ProgrÃ¨s",challengeCreated:"DÃ©fi crÃ©Ã© avec succÃ¨s!",taskCompleted:"TÃ¢che complÃ©tÃ©e pour aujourd'hui!",deleteChallenge:"Supprimer le DÃ©fi"}},h=T[i]||T.en;l.useEffect(()=>{(async()=>{try{const{data:{session:j}}=await W.auth.getSession();j&&(m(j.user.id),await w(j.user.id))}catch(j){console.error("Error loading user data:",j)}})()},[]);const w=async c=>{try{const{challenges:j,progress:E}=await Ve(c);y(j);const R={};E.forEach(H=>{R[H.challenge_id]=H}),M(R)}catch(j){console.error("Error loading challenges:",j)}},A=async()=>{if(!t.trim()){Q.error("Please enter a challenge name");return}if(n.length===0){Q.error("Please select at least one challenge type");return}if(N){b(!0);try{await Ye({user_id:N,name:t,types:n,duration_days:u,difficulty_level:v}),new Audio("/sounds/challenge-created.mp3").play().catch(j=>console.log("Audio play failed:",j)),Q.success(h.challengeCreated),r(""),d([]),g(7),f(5),a(!1),await w(N)}catch(c){console.error("Error creating challenge:",c),Q.error("Failed to create challenge")}finally{b(!1)}}},S=async c=>{if(N)try{await He(N,c),new Audio("/sounds/task-complete.mp3").play().catch(E=>console.log("Audio play failed:",E)),Q.success(h.taskCompleted),await w(N)}catch(j){console.error("Error completing task:",j),Q.error("Failed to complete task")}},L=c=>{d(j=>j.includes(c)?j.filter(E=>E!==c):[...j,c])},o=c=>{const j=new Date(c.created_at),E=new Date(j);E.setDate(j.getDate()+c.duration_days);const R=new Date,H=Math.ceil((E.getTime()-R.getTime())/(1e3*60*60*24));return H>0?H:0},x=c=>{const j=C[c];return j?Math.round(j.days_completed/j.total_days*100):0},k=c=>{const j=C[c];if(!j)return!1;const E=new Date(j.last_completed_at),R=new Date;return E.getDate()===R.getDate()&&E.getMonth()===R.getMonth()&&E.getFullYear()===R.getFullYear()},P=c=>c.map(j=>{const E=ie.find(R=>R.id===j);return E?E.icon:""}).join(" ");return e.jsxs($,{className:"w-full",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between",children:[e.jsxs(B,{className:"flex items-center text-lg font-medium",children:[e.jsx(G,{className:"mr-2 h-5 w-5 text-amber-500"}),h.title]}),!s&&e.jsxs(U,{onClick:()=>a(!0),size:"sm",className:"flex items-center",children:[e.jsx(Oe,{className:"mr-1 h-4 w-4"}),h.createChallenge]})]}),e.jsx(z,{children:e.jsx(ae,{mode:"wait",children:s?e.jsxs(D.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:h.challengeName}),e.jsx(Be,{value:t,onChange:c=>r(c.target.value),placeholder:"e.g., 7-Day Hydration Challenge"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:h.challengeTypes}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ie.map(c=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ze,{id:`type-${c.id}`,checked:n.includes(c.id),onCheckedChange:()=>L(c.id)}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsxs("label",{htmlFor:`type-${c.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[c.icon," ",c.label]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c.description})]})]},c.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:h.duration}),e.jsxs("span",{className:"text-sm",children:[u," ",u===1?h.day:h.days]})]}),e.jsx(le,{min:1,max:30,step:1,value:[u],onValueChange:c=>g(c[0])})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:h.difficulty}),e.jsxs("span",{className:"text-sm",children:[v,"/10"]})]}),e.jsx(le,{min:1,max:10,step:1,value:[v],onValueChange:c=>f(c[0])}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:h.easy}),e.jsx("span",{children:h.hard})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(U,{variant:"outline",onClick:()=>a(!1),children:h.cancel}),e.jsx(U,{onClick:A,disabled:p,children:p?h.creating:h.create})]})]},"create-form"):e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("h3",{className:"text-md font-medium mb-4",children:h.activeChallenges}),q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"h-12 w-12 mx-auto text-gray-300 mb-2"}),e.jsx("p",{className:"text-gray-500",children:h.noChallenges})]}):e.jsx("div",{className:"space-y-4",children:q.map(c=>e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium flex items-center",children:[e.jsx("span",{className:"mr-2",children:P(c.types)}),c.name]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center mt-1",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),o(c)," ",h.daysLeft]})]}),e.jsxs("div",{className:"text-xs px-2 py-1 bg-primary/10 rounded-full",children:[h.difficulty,": ",c.difficulty_level,"/10"]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:h.progress}),e.jsxs("span",{children:[x(c.id),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:e.jsx("div",{className:"bg-primary h-2.5 rounded-full",style:{width:`${x(c.id)}%`}})})]}),e.jsx("div",{className:"mt-4 flex justify-between",children:k(c.id)?e.jsxs(U,{variant:"outline",disabled:!0,className:"w-full",children:[e.jsx(Z,{className:"mr-1 h-4 w-4"}),h.completed]}):e.jsxs(U,{onClick:()=>S(c.id),variant:"default",className:"w-full",children:[e.jsx(Z,{className:"mr-1 h-4 w-4"}),h.markComplete]})})]},c.id))})]},"challenges-list")})})]})},ls=({level:s,points:a,pointsForNextLevel:t})=>{const[r,n]=l.useState(!1),{language:d}=F(),u={en:{yourLevel:"Your Level",pointsToNextLevel:"points to next level"},fr:{yourLevel:"Votre Niveau",pointsToNextLevel:"points pour le niveau suivant"}},g=u[d]||u.en;l.useEffect(()=>{n(!0);const f=setTimeout(()=>n(!1),1e3);return()=>clearTimeout(f)},[s]);const v=Math.min(100,Math.round(a/t*100));return e.jsxs($,{children:[e.jsx(I,{className:"pb-2",children:e.jsxs(B,{className:"text-sm flex items-center",children:[e.jsx(Me,{className:"h-4 w-4 mr-2 text-yellow-500"}),g.yourLevel]})}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D.div,{animate:r?{scale:[1,1.2,1]}:{},transition:{duration:.5},className:"text-3xl font-bold",children:s}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx(me,{value:v,className:"h-2"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[t-a," ",g.pointsToNextLevel]})]})]})})]})},ns=({streak:s,updateStreak:a})=>{const[t,r]=l.useState(!1),[n,d]=l.useState(!1),{language:u}=F(),g={en:{dailyStreak:"Daily Streak",days:"days",checkIn:"Daily Check-in",checkedIn:"Checked In",streakBonus:"Streak Bonus"},fr:{dailyStreak:"SÃ©rie Quotidienne",days:"jours",checkIn:"PrÃ©sence Quotidienne",checkedIn:"PrÃ©sent",streakBonus:"Bonus de SÃ©rie"}},v=g[u]||g.en;l.useEffect(()=>{(async()=>{const y=localStorage.getItem("lastCheckIn");if(y){const C=new Date().toDateString();r(y===C)}})()},[]);const f=async()=>{if(!t){d(!0);try{await a(),r(!0),localStorage.setItem("lastCheckIn",new Date().toDateString())}catch(q){console.error("Error checking in:",q)}finally{d(!1)}}};return e.jsxs($,{children:[e.jsx(I,{className:"pb-2",children:e.jsxs(B,{className:"text-sm flex items-center",children:[e.jsx(We,{className:"h-4 w-4 mr-2 text-orange-500"}),v.dailyStreak]})}),e.jsx(z,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D.div,{animate:{scale:[1,1.1,1]},transition:{repeat:Number.POSITIVE_INFINITY,repeatType:"reverse",duration:1.5},className:"text-3xl font-bold",children:s}),e.jsx("div",{className:"ml-2 text-sm text-muted-foreground",children:v.days}),s>0&&s%7===0&&e.jsx(D.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"ml-auto px-2 py-1 bg-amber-100 text-amber-800 text-xs rounded-full",children:v.streakBonus})]})}),e.jsx(ue,{children:e.jsx(U,{onClick:f,disabled:t||n,variant:t?"outline":"default",className:"w-full",size:"sm",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-1 h-4 w-4"}),v.checkedIn]}):v.checkIn})})]})},is=({userId:s,addPoints:a})=>{const[t,r]=l.useState([]),[n,d]=l.useState(null),[u,g]=l.useState(!1),[v,f]=l.useState([]),[q,y]=l.useState("all"),{language:C}=F(),M={en:{title:"Nutrition Badges",all:"All",locked:"Locked",unlocked:"Unlocked",progress:"Progress",badgeUnlocked:"Badge Unlocked!",earnedPoints:"You earned",points:"points",continue:"Continue"},fr:{title:"Badges Nutritionnels",all:"Tous",locked:"VerrouillÃ©s",unlocked:"DÃ©verrouillÃ©s",progress:"ProgrÃ¨s",badgeUnlocked:"Badge DÃ©verrouillÃ© !",earnedPoints:"Vous avez gagnÃ©",points:"points",continue:"Continuer"}},N=M[C]||M.en;l.useEffect(()=>{(async()=>{if(s)try{const{data:T,error:h}=await _.from("badges").select("*").eq("active",!0).order("rarity",{ascending:!1});if(h)throw h;const{data:w,error:A}=await _.from("user_badges").select("badge_id, progress, total, unlocked_at, is_equipped").eq("user_id",s);if(A)throw A;const S=new Map;w==null||w.forEach(x=>{S.set(x.badge_id,{unlocked:!!x.unlocked_at,progress:x.progress||0,total:x.total||1,unlocked_at:x.unlocked_at,is_equipped:x.is_equipped||!1})});const L=T==null?void 0:T.map(x=>{const k=S.get(x.id);return{...x,unlocked:(k==null?void 0:k.unlocked)||!1,progress:(k==null?void 0:k.progress)||0,total:(k==null?void 0:k.total)||x.requirement_count||1,unlocked_at:k==null?void 0:k.unlocked_at,is_equipped:(k==null?void 0:k.is_equipped)||!1}});r(L||[]);const o=Array.from(new Set((L==null?void 0:L.map(x=>x.category))||[]));f(o)}catch(T){console.error("Error loading badges:",T)}})()},[s]);const m=t.filter(i=>q==="all"||i.category===q),p=i=>{d(i)},b=i=>{switch(i.toLowerCase()){case"common":return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400";case"uncommon":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"rare":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"legendary":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{children:[e.jsx(I,{className:"pb-2",children:e.jsxs(B,{className:"flex items-center text-lg font-medium",children:[e.jsx(Ze,{className:"h-5 w-5 mr-2 text-purple-500"}),N.title]})}),e.jsxs(z,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("button",{onClick:()=>y("all"),className:`px-3 py-1 text-sm rounded-full ${q==="all"?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:N.all}),v.map(i=>e.jsx("button",{onClick:()=>y(i),className:`px-3 py-1 text-sm rounded-full ${q===i?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:i},i))]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:m.map(i=>e.jsxs(D.div,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>p(i),className:`relative cursor-pointer rounded-lg p-4 flex flex-col items-center text-center ${i.unlocked?"bg-primary/10 border border-primary/30":"bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:`text-2xl mb-2 ${i.unlocked?"opacity-100":"opacity-50"}`,children:i.icon}),e.jsx("div",{className:"font-medium text-sm",children:i.name}),i.progress!==void 0&&i.total!==void 0&&e.jsxs("div",{className:"w-full mt-2",children:[e.jsx("div",{className:"h-1.5 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${Math.min(100,i.progress/i.total*100)}%`}})}),e.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:[i.progress,"/",i.total]})]}),!i.unlocked&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}),e.jsx("div",{className:`absolute bottom-2 right-2 text-xs px-1.5 py-0.5 rounded-full ${b(i.rarity)}`,children:i.rarity})]},i.id))})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>{d(null),g(!1)},children:e.jsx(D.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full",onClick:i=>i.stopPropagation(),children:u?e.jsxs("div",{className:"text-center",children:[e.jsx(D.div,{initial:{scale:0},animate:{scale:[0,1.2,1]},transition:{duration:.5},className:"text-6xl mb-4 mx-auto",children:n.icon}),e.jsx(D.h3,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-2xl font-bold mb-2",children:N.badgeUnlocked}),e.jsx(D.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"text-lg mb-2",children:n.name}),e.jsx(D.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},className:"text-sm text-gray-500 mb-4",children:n.description}),e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.9},className:"text-amber-500 font-bold mb-6",children:[N.earnedPoints," ",n.points," ",N.points,"!"]}),e.jsx(U,{onClick:()=>g(!1),children:N.continue})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"text-4xl mr-4",children:n.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:n.name}),e.jsx("div",{className:`text-xs px-2 py-0.5 rounded-full inline-block ${b(n.rarity)}`,children:n.rarity})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:n.description}),n.progress!==void 0&&n.total!==void 0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:N.progress}),e.jsxs("span",{children:[n.progress,"/",n.total]})]}),e.jsx("div",{className:"h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${Math.min(100,n.progress/n.total*100)}%`}})})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:[N.earnedPoints,": ",n.points," ",N.points]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(U,{variant:"outline",onClick:()=>d(null),children:N.continue})})]})})})]})};var re="Avatar",[os,zs]=Ce(re),[cs,ge]=os(re),fe=l.forwardRef((s,a)=>{const{__scopeAvatar:t,...r}=s,[n,d]=l.useState("idle");return e.jsx(cs,{scope:t,imageLoadingStatus:n,onImageLoadingStatusChange:d,children:e.jsx(se.span,{...r,ref:a})})});fe.displayName=re;var ye="AvatarImage",je=l.forwardRef((s,a)=>{const{__scopeAvatar:t,src:r,onLoadingStatusChange:n=()=>{},...d}=s,u=ge(ye,t),g=ds(r,d.referrerPolicy),v=Se(f=>{n(f),u.onImageLoadingStatusChange(f)});return de(()=>{g!=="idle"&&v(g)},[g,v]),g==="loaded"?e.jsx(se.img,{...d,ref:a,src:r}):null});je.displayName=ye;var ve="AvatarFallback",be=l.forwardRef((s,a)=>{const{__scopeAvatar:t,delayMs:r,...n}=s,d=ge(ve,t),[u,g]=l.useState(r===void 0);return l.useEffect(()=>{if(r!==void 0){const v=window.setTimeout(()=>g(!0),r);return()=>window.clearTimeout(v)}},[r]),u&&d.imageLoadingStatus!=="loaded"?e.jsx(se.span,{...n,ref:a}):null});be.displayName=ve;function ds(s,a){const[t,r]=l.useState("idle");return de(()=>{if(!s){r("error");return}let n=!0;const d=new window.Image,u=g=>()=>{n&&r(g)};return r("loading"),d.onload=u("loaded"),d.onerror=u("error"),d.src=s,a&&(d.referrerPolicy=a),()=>{n=!1}},[s,a]),t}var Ne=fe,we=je,ke=be;const K=l.forwardRef(({className:s,...a},t)=>e.jsx(Ne,{ref:t,className:te("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));K.displayName=Ne.displayName;const X=l.forwardRef(({className:s,...a},t)=>e.jsx(we,{ref:t,className:te("aspect-square h-full w-full",s),...a}));X.displayName=we.displayName;const ee=l.forwardRef(({className:s,...a},t)=>e.jsx(ke,{ref:t,className:te("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));ee.displayName=ke.displayName;const us=({userId:s})=>{const[a,t]=l.useState([]),[r,n]=l.useState(null),[d,u]=l.useState("weekly"),{language:g}=F(),v={en:{title:"Nutrition Leaderboard",weekly:"Weekly",monthly:"Monthly",allTime:"All Time",rank:"Rank",user:"User",level:"Level",points:"Points",yourRank:"Your Rank",loading:"Loading leaderboard..."},fr:{title:"Classement Nutritionnel",weekly:"Hebdomadaire",monthly:"Mensuel",allTime:"Tout Temps",rank:"Rang",user:"Utilisateur",level:"Niveau",points:"Points",yourRank:"Votre Rang",loading:"Chargement du classement..."}},f=v[g]||v.en;l.useEffect(()=>{(async()=>{if(s)try{let C=_.from("user_gamification").select(`
            user_id,
            points,
            level,
            profiles:user_id (
              username,
              avatar_url
            )
          `).order("points",{ascending:!1}).limit(100);if(d==="weekly"){const m=new Date;m.setDate(m.getDate()-7),C=C.gte("last_updated",m.toISOString())}else if(d==="monthly"){const m=new Date;m.setMonth(m.getMonth()-1),C=C.gte("last_updated",m.toISOString())}const{data:M,error:N}=await C;if(N)throw N;if(M){const m=M.map((b,i)=>{var T,h;return{user_id:b.user_id,username:((T=b.profiles)==null?void 0:T.username)||`User ${b.user_id.slice(0,4)}`,avatar_url:(h=b.profiles)==null?void 0:h.avatar_url,points:b.points,level:b.level,rank:i+1}});t(m);const p=m.find(b=>b.user_id===s);n(p||null)}}catch(C){console.error("Error loading leaderboard:",C)}})()},[s,d]);const q=y=>{switch(y){case 1:return e.jsx(xe,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(ne,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(ne,{className:"h-5 w-5 text-amber-700"});default:return null}};return e.jsxs($,{children:[e.jsxs(I,{className:"pb-2",children:[e.jsxs(B,{className:"flex items-center text-lg font-medium",children:[e.jsx(G,{className:"h-5 w-5 mr-2 text-amber-500"}),f.title]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx("button",{onClick:()=>u("weekly"),className:`px-3 py-1 text-sm rounded-full ${d==="weekly"?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:f.weekly}),e.jsx("button",{onClick:()=>u("monthly"),className:`px-3 py-1 text-sm rounded-full ${d==="monthly"?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:f.monthly}),e.jsx("button",{onClick:()=>u("alltime"),className:`px-3 py-1 text-sm rounded-full ${d==="alltime"?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:f.allTime})]})]}),e.jsx(z,{children:a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto text-gray-300 mb-2"}),e.jsx("p",{children:f.loading})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-xs text-gray-500 border-b",children:[e.jsx("th",{className:"font-medium text-left py-2 w-16",children:f.rank}),e.jsx("th",{className:"font-medium text-left py-2",children:f.user}),e.jsx("th",{className:"font-medium text-right py-2 w-16",children:f.level}),e.jsx("th",{className:"font-medium text-right py-2 w-24",children:f.points})]})}),e.jsx("tbody",{children:a.map(y=>e.jsxs(D.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:`border-b last:border-0 ${y.user_id===s?"bg-primary/5":"hover:bg-gray-50 dark:hover:bg-gray-800/50"}`,children:[e.jsx("td",{className:"py-3 text-center",children:e.jsx("div",{className:"flex items-center",children:q(y.rank)||e.jsx("span",{children:y.rank})})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(K,{className:"h-8 w-8 mr-2",children:[e.jsx(X,{src:y.avatar_url||""}),e.jsx(ee,{children:y.username.charAt(0).toUpperCase()})]}),e.jsx("span",{className:"font-medium",children:y.username})]})}),e.jsx("td",{className:"py-3 text-right",children:y.level}),e.jsx("td",{className:"py-3 text-right font-medium",children:y.points})]},y.user_id))})]})}),r&&r.rank>10&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:f.yourRank}),e.jsx("table",{className:"w-full",children:e.jsx("tbody",{children:e.jsxs("tr",{className:"bg-primary/5",children:[e.jsx("td",{className:"py-3 w-16 text-center",children:r.rank}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(K,{className:"h-8 w-8 mr-2",children:[e.jsx(X,{src:r.avatar_url||""}),e.jsx(ee,{children:r.username.charAt(0).toUpperCase()})]}),e.jsx("span",{className:"font-medium",children:r.username})]})}),e.jsx("td",{className:"py-3 w-16 text-right",children:r.level}),e.jsx("td",{className:"py-3 w-24 text-right font-medium",children:r.points})]})})})]})]})})]})},ms=async()=>{const{data:s,error:a}=await _.from("nutrition_quests").select("*").eq("active",!0);return a?(console.error("Supabase error:",a),[]):s},oe={async getQuestsByType(s){const{data:a,error:t}=await _.from("quests").select("*").eq("quest_type",s).order("created_at",{ascending:!1});return t?(console.error(`Error fetching ${s} quests:`,t),[]):a||[]},async getDailyQuests(){return this.getQuestsByType("daily")},async getWeeklyQuests(){return this.getQuestsByType("weekly")},async getMonthlyQuests(){return this.getQuestsByType("monthly")},async getUserQuestsByUserId(s){if(!s)return[];const{data:a,error:t}=await _.from("user_quests").select("*").eq("user_id",s);return t?(console.error("Error fetching user quests:",t),[]):a||[]},async getUserQuests(s){if(!s)return[];const{data:a,error:t}=await _.from("user_quests").select("*, quest:quest_id(*)").eq("user_id",s);return t?(console.error("Error fetching user quests:",t),[]):a||[]},async startQuest(s,a){if(!s||!a)return null;const{data:t}=await _.from("user_quests").select("*").eq("user_id",s).eq("quest_id",a).maybeSingle();if(t)return t;const{data:r,error:n}=await _.from("user_quests").insert({user_id:s,quest_id:a,current_step:0,completed:!1,started_at:new Date().toISOString()}).select().single();return n?(console.error("Error starting quest:",n),null):r},async updateQuestProgress(s,a,t){if(!s||!a)return!1;const{error:r}=await _.from("user_quests").update({current_step:t}).eq("user_id",s).eq("quest_id",a);return r?(console.error("Error updating quest progress:",r),!1):!0},async completeQuest(s,a,t){if(!s||!a)return!1;const{error:r}=await _.from("user_quests").update({current_step:t,completed:!0,completed_at:new Date().toISOString()}).eq("user_id",s).eq("quest_id",a);return r?(console.error("Error completing quest:",r),!1):!0},async completeQuestStep(s,a,t){if(!s||!a)return{success:!1,completed:!1};const{data:r,error:n}=await _.from("quests").select("*").eq("id",a).single();if(n)return console.error("Error fetching quest:",n),{success:!1,completed:!1};const{data:d,error:u}=await _.from("user_quests").select("*").eq("user_id",s).eq("quest_id",a).single();if(u)return console.error("Error fetching user quest:",u),{success:!1,completed:!1};const g=r.steps||[];if(t>=g.length)return{success:!1,completed:!1};g[t].completed=!0;const v=t+1,f=g.every(C=>C.completed),q={current_step:v};f&&(q.completed=!0,q.completed_at=new Date().toISOString());const{error:y}=await _.from("user_quests").update(q).eq("id",d.id);return y?(console.error("Error updating user quest:",y),{success:!1,completed:!1}):{success:!0,completed:f}},async getActiveQuestsByType(s,a){if(!s)return[];const{data:t,error:r}=await _.from("user_quests").select("*, quest:quest_id(*)").eq("user_id",s).eq("completed",!1).filter("quest.quest_type","eq",a);return r?(console.error(`Error fetching ${a} quests:`,r),[]):t||[]},async getCompletedQuestsByType(s,a){if(!s)return[];const{data:t,error:r}=await _.from("user_quests").select("*, quest:quest_id(*)").eq("user_id",s).eq("completed",!0).filter("quest.quest_type","eq",a);return r?(console.error(`Error fetching completed ${a} quests:`,r),[]):t||[]},getNutritionQuests:ms},ce={en:{title:"Today's Quests",available:"Available",active:"Active",completed:"Completed",start:"Start Quest",continue:"Continue",claim:"Claim Rewards",difficulty:"Difficulty",duration:"Duration",days:"days",rewards:"Rewards",points:"points",steps:"Steps",progress:"Progress",questStarted:"Quest started!",questCompleted:"Quest completed!",rewardsEarned:"Rewards earned",timeLeft:"Time left",noActiveQuests:"No active quests. Start a new quest from the Available tab!",noAvailableQuests:"No available quests at the moment. Check back later!",noCompletedQuests:"You haven't completed any quests yet. Complete quests to earn rewards!",back:"Back to quests",completeStep:"Complete Step"},fr:{title:"QuÃªtes du Jour",available:"Disponibles",active:"Actives",completed:"TerminÃ©es",start:"Commencer la QuÃªte",continue:"Continuer",claim:"RÃ©clamer RÃ©compenses",difficulty:"DifficultÃ©",duration:"DurÃ©e",days:"jours",rewards:"RÃ©compenses",points:"points",steps:"Ã‰tapes",progress:"ProgrÃ¨s",questStarted:"QuÃªte commencÃ©e !",questCompleted:"QuÃªte terminÃ©e !",rewardsEarned:"RÃ©compenses gagnÃ©es",timeLeft:"Temps restant",noActiveQuests:"Pas de quÃªtes actives. Commencez une nouvelle quÃªte depuis l'onglet Disponibles !",noAvailableQuests:"Pas de quÃªtes disponibles pour le moment. Revenez plus tard !",noCompletedQuests:"Vous n'avez pas encore terminÃ© de quÃªtes. ComplÃ©tez des quÃªtes pour gagner des rÃ©compenses !",back:"Retour aux quÃªtes",completeStep:"ComplÃ©ter l'Ã©tape"}},hs=({userId:s,addPoints:a})=>{const[t,r]=l.useState([]),[n,d]=l.useState([]);l.useState([]);const[u,g]=l.useState(null),[v,f]=l.useState(!1);l.useState("available");const{language:q}=F(),y=ce[q]||ce.en;l.useEffect(()=>{(async()=>{f(!0);try{const p=await oe.getNutritionQuests();r(p||[])}catch(p){console.error("Error loading quests:",p)}finally{f(!1)}})()},[]);const C=async m=>{if(s)try{const p=new Date().toISOString();if(!await oe.startQuest(s,m.id))throw new Error("Failed to start quest");const i={...m,started_at:p};r(h=>h.filter(w=>w.id!==m.id)),d(h=>[...h,i]),g(i),Q.success(y.questStarted,{description:m.title}),new Audio("/sounds/quest-start.mp3").play().catch(h=>console.log("Audio play failed:",h))}catch(p){console.error("Error starting quest:",p)}},M=m=>e.jsxs(D.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"border rounded-lg p-4 cursor-pointer hover:border-primary transition-colors",onClick:()=>g(m),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-medium",children:m.title}),e.jsx("div",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-800",children:m.difficulty})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-3 line-clamp-2",children:m.description}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500 mb-3",children:[e.jsxs("span",{children:["Points: ",m.points]}),e.jsxs("span",{children:["Category: ",m.category]})]}),e.jsx("button",{onClick:p=>{p.stopPropagation(),C(m)},className:"mt-2 bg-primary text-white py-1 px-4 rounded-md text-sm hover:bg-primary/90 transition-colors",children:y.start})]},m.id),N=(m,p)=>{let b="";switch(m){case"available":b=p.noAvailableQuests;break;case"active":b=p.noActiveQuests;break;case"completed":b=p.noCompletedQuests;break}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[e.jsx(Xe,{className:"h-12 w-12 text-gray-300 dark:text-gray-600 mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:b}),m==="active"]})};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:e.jsx("h2",{className:"text-xl font-bold",children:y.title})}),e.jsx("div",{className:"p-4",children:v?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.length>0?t.map(m=>M(m)):N("available",y)})})]})},Vs=({userId:s,standalone:a=!0})=>{const[t,r]=l.useState("dashboard"),[n,d]=l.useState(0),[u,g]=l.useState(1),[v,f]=l.useState(!1),[q,y]=l.useState(0),{language:C}=F(),{isMobile:M,isTablet:N}=he(),m={en:{title:"Nutrition Game Center",dashboard:"Dashboard",challenges:"Challenges",rewards:"Rewards",badges:"Badges",leaderboard:"Leaderboard",quests:"Quests",yourLevel:"Your Level",yourPoints:"Your Points",dailyStreak:"Daily Streak",days:"days",levelUp:"Level Up!",congratulations:"Congratulations! You've reached level",continue:"Continue",pointsEarned:"Points earned",pointsNeeded:"Points needed for next level"},fr:{title:"Centre de Jeu Nutritionnel",dashboard:"Tableau de Bord",challenges:"DÃ©fis",rewards:"RÃ©compenses",badges:"Badges",leaderboard:"Classement",quests:"QuÃªtes",yourLevel:"Votre Niveau",yourPoints:"Vos Points",dailyStreak:"SÃ©rie Quotidienne",days:"jours",levelUp:"Niveau SupÃ©rieur !",congratulations:"FÃ©licitations ! Vous avez atteint le niveau",continue:"Continuer",pointsEarned:"Points gagnÃ©s",pointsNeeded:"Points nÃ©cessaires pour le niveau suivant"}},p=m[C]||m.en;l.useEffect(()=>{(async()=>{if(s)try{const{data:A,error:S}=await _.from("user_gamification").select("*").eq("user_id",s).single();if(S&&S.code!=="PGRST116"){console.error("Error fetching user gamification data:",S);return}A?(d(A.points||0),g(A.level||1),y(A.streak||0)):await _.from("user_gamification").insert({user_id:s,points:0,level:1,streak:0,last_check_in:new Date().toISOString()})}catch(A){console.error("Error in loadUserGamificationData:",A)}})()},[s]);const b=w=>Math.floor(100*Math.pow(1.5,w-1)),i=async(w,A)=>{if(s)try{const S=n+w,L=b(u);let o=u;S>=L&&(o=u+1,f(!0),new Audio("/sounds/level-up.mp3").play().catch(k=>console.log("Audio play failed:",k))),d(S),g(o),await _.from("user_gamification").upsert({user_id:s,points:S,level:o,last_updated:new Date().toISOString()}),await _.from("points_history").insert({user_id:s,points:w,reason:A,created_at:new Date().toISOString()}),Q.success(`+${w} points: ${A}`,{description:`You now have ${S} points`})}catch(S){console.error("Error adding points:",S)}},T=async()=>{if(s)try{const{data:w,error:A}=await _.from("user_gamification").select("streak, last_check_in").eq("user_id",s).single();if(A){console.error("Error fetching streak data:",A);return}const S=new Date(w.last_check_in),L=new Date,o=new Date(L);o.setDate(o.getDate()-1);const x=S.getDate()===o.getDate()&&S.getMonth()===o.getMonth()&&S.getFullYear()===o.getFullYear();if(!(S.getDate()===L.getDate()&&S.getMonth()===L.getMonth()&&S.getFullYear()===L.getFullYear())){const P=x?w.streak+1:1;if(y(P),await _.from("user_gamification").update({streak:P,last_check_in:L.toISOString()}).eq("user_id",s),P>0){let c=10;P%7===0?c+=50:P%3===0&&(c+=20),i(c,`${P} day streak bonus`),new Audio("/sounds/streak.mp3").play().catch(E=>console.log("Audio play failed:",E))}}}catch(w){console.error("Error updating streak:",w)}},h=e.jsxs("div",{className:"space-y-6 flex-1 p-3 sm:p-4 ${isMobile ? 'mt-16' : 'md:ml-64'}",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx(G,{className:"h-6 w-6 mr-2 text-amber-500"}),p.title]})}),e.jsx(ae,{children:v&&e.jsx(D.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"fixed inset-0 flex items-center justify-center z-50 bg-black/50",onClick:()=>f(!1),children:e.jsxs(D.div,{initial:{y:50},animate:{y:0},className:"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full text-center",onClick:w=>w.stopPropagation(),children:[e.jsx(D.div,{initial:{rotate:0,scale:1},animate:{rotate:[0,10,-10,10,0],scale:[1,1.2,1]},transition:{duration:.6},children:e.jsx(xe,{className:"h-16 w-16 mx-auto text-yellow-500 mb-4"})}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:p.levelUp}),e.jsxs("p",{className:"text-lg mb-4",children:[p.congratulations," ",u,"!"]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsx(D.div,{initial:{width:0},animate:{width:"100%"},transition:{delay:.3,duration:.8},className:"h-2 bg-green-500 rounded-full"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Level ",u-1]}),e.jsxs("span",{children:["Level ",u]})]})]}),e.jsx(U,{onClick:()=>f(!1),children:p.continue})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ls,{level:u,points:n,pointsForNextLevel:b(u)}),e.jsx(ns,{streak:q,updateStreak:T}),e.jsxs($,{children:[e.jsx(I,{className:"pb-2",children:e.jsxs(B,{className:"text-sm flex items-center",children:[e.jsx(es,{className:"h-4 w-4 mr-2 text-purple-500"}),p.yourPoints]})}),e.jsxs(z,{children:[e.jsx("div",{className:"text-3xl font-bold",children:n}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[b(u)-n," ",p.pointsNeeded]}),e.jsx(me,{value:n/b(u)*100,className:"h-2 mt-2"})]})]})]}),e.jsxs(_e,{defaultValue:"dashboard",value:t,onValueChange:r,children:[e.jsxs(qe,{className:`w-full ${M?"":"grid-cols-4"}`,children:[e.jsxs(V,{value:"dashboard",children:[" ",e.jsx(Ae,{className:"h-4 w-4"}),!M&&p.dashboard]}),e.jsxs(V,{value:"challenges",children:[" ",e.jsx(pe,{className:"h-4 w-4"}),!M&&p.challenges," "]}),e.jsxs(V,{value:"rewards",children:[" ",e.jsx(Ee,{className:"h-4 w-4"}),!M&&p.rewards]}),e.jsxs(V,{value:"badges",children:[" ",e.jsx(Je,{className:"h-4 w-4"}),!M&&p.badges]}),e.jsxs(V,{value:"leaderboard",children:[e.jsx(G,{className:"h-4 w-4"}),!M&&p.leaderboard]}),e.jsxs(V,{value:"quests",children:[" ",e.jsx(Ke,{className:"h-4 w-4"}),!M&&p.quests]})]}),e.jsx(Y,{value:"dashboard",className:"space-y-4 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-10",children:[e.jsx(Pe,{}),e.jsx(as,{})]})}),e.jsx(Y,{value:"challenges",className:"mt-6",children:e.jsx(rs,{})}),e.jsx(Y,{value:"rewards",className:"mt-6",children:e.jsx(Le,{})}),e.jsx(Y,{value:"badges",className:"mt-6",children:e.jsx(is,{userId:s,addPoints:i})}),e.jsx(Y,{value:"leaderboard",className:"mt-6",children:e.jsx(us,{userId:s})}),e.jsx(Y,{value:"quests",className:"mt-6",children:e.jsx(hs,{userId:s,addPoints:i})})]})]});return a?e.jsxs("div",{className:"flex min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(Te,{activePage:"Nutrition Game"}),e.jsx("div",{className:`flex-1 p-8 ${M?"":"ml-64"}`,children:h})]}):h};export{Vs as default};
