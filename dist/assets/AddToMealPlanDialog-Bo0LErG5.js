import{r as s,d as R,s as n,j as a,B as g}from"./index-wx0cpdQ-.js";import{D as q,f as B,a as Q,b as V,c as $}from"./dialog-iH9WTBjz.js";import{I as z}from"./input-DlubX1PJ.js";import{S as H,a as O,b as U,c as G,d as w}from"./select-Dvj3AB60.js";import{P as J}from"./plus-Ci3g5hd-.js";import{S as K}from"./search-C5ZZVUmr.js";function se({planId:C,dayOfWeek:f,mealTime:h,onMealAdded:M}){const[d,m]=s.useState(!1),[x,A]=s.useState([]),[p,j]=s.useState([]),[i,y]=s.useState(""),[o,I]=s.useState(""),[c,D]=s.useState(""),[E,F]=s.useState([]),[P,v]=s.useState(!1),[_,b]=s.useState(!1),{toast:r}=R();s.useEffect(()=>{d&&(T(),L())},[d]),s.useEffect(()=>{let e=[...x];o&&(e=e.filter(t=>t.meal_name.toLowerCase().includes(o.toLowerCase()))),c&&(e=e.filter(t=>t.category_id===c)),j(e)},[x,o,c]);const T=async()=>{v(!0);try{const{data:e,error:t}=await n.from("meals").select(`
          id,
          meal_name,
          image_url,
          category_id,
          subcategory_id,
          meal_categories (name),
          meal_subcategories (name)
        `).order("meal_name");if(t)throw t;if(e){const l=e.map(u=>{var N,S;return{...u,category_name:(N=u.meal_categories)==null?void 0:N.name,subcategory_name:(S=u.meal_subcategories)==null?void 0:S.name}});A(l),j(l)}}catch(e){r({title:"Error",description:"Failed to load meals: "+e.message,variant:"destructive"})}finally{v(!1)}},L=async()=>{try{const{data:e,error:t}=await n.from("meal_categories").select("id, name").order("name");if(t)throw t;F(e||[])}catch(e){r({title:"Error",description:"Failed to load categories: "+e.message,variant:"destructive"})}},k=async()=>{if(!i){r({title:"Selection Required",description:"Please select a meal to add",variant:"destructive"});return}b(!0);try{const{data:{user:e}}=await n.auth.getUser();if(!e){r({title:"Authentication Required",description:"Please log in to add meals to your plan",variant:"destructive"});return}const{data:t,error:l}=await n.from("meal_plan_items").insert({meal_plan_id:C,meal_id:i,day_of_week:f,meal_time:h,user_id:e.id}).select().single();if(l)throw l;r({title:"Success",description:"Meal added to your plan"}),m(!1),y(""),M()}catch(e){r({title:"Error",description:"Failed to add meal to plan: "+e.message,variant:"destructive"})}finally{b(!1)}};return a.jsxs(q,{open:d,onOpenChange:m,children:[a.jsx(B,{asChild:!0,children:a.jsxs(g,{variant:"outline",className:"add-meal",children:[a.jsx(J,{size:16,className:"mr-2"}),a.jsx("span",{children:"Add Meal"})]})}),a.jsxs(Q,{className:"sm:max-w-[500px]",children:[a.jsx(V,{children:a.jsxs($,{children:["Add Meal to ",f," - ",h]})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(K,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(z,{placeholder:"Search meals...",value:o,onChange:e=>I(e.target.value),className:"pl-8"})]}),a.jsxs(H,{value:c,onValueChange:D,children:[a.jsx(O,{className:"w-[180px]",children:a.jsx(U,{placeholder:"All Categories"})}),a.jsxs(G,{children:[a.jsx(w,{value:"all",children:"All Categories"}),E.map(e=>a.jsx(w,{value:e.id,children:e.name},e.id))]})]})]}),a.jsx("div",{className:"max-h-[300px] overflow-y-auto border rounded-md",children:P?a.jsx("div",{className:"flex justify-center items-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):p.length>0?a.jsx("div",{className:"grid gap-2 p-2",children:p.map(e=>a.jsxs("div",{className:`flex items-center p-2 rounded-md cursor-pointer hover:bg-gray-100 ${i===e.id?"bg-gray-100 border border-primary":""}`,onClick:()=>y(e.id),children:[a.jsx("div",{className:"h-12 w-12 mr-3 bg-gray-200 rounded overflow-hidden",children:e.image_url?a.jsx("img",{src:e.image_url||"/placeholder.jpg",alt:e.meal_name,className:"h-full w-full object-cover"}):a.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-400 text-xs",children:"No Image"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium",children:e.meal_name}),a.jsxs("div",{className:"text-xs text-gray-500",children:[e.category_name," ",e.subcategory_name?`â€¢ ${e.subcategory_name}`:""]})]})]},e.id))}):a.jsx("div",{className:"py-8 text-center text-gray-500",children:"No meals found. Try adjusting your search or filter."})})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx(g,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),a.jsx(g,{onClick:k,disabled:_||!i,children:_?"Adding...":"Add to Plan"})]})]})]})}export{se as A};
