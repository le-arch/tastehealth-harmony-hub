import{c as R,r as m,j as e,B as x,J as P}from"./index-wx0cpdQ-.js";import{b as A,G as I,P as K,T as G,C as O}from"./ProfileSidebar-CUX9nyIG.js";import{C as Q}from"./ChallengeCreator-DAZWG7kY.js";import{s as S}from"./SupabaseClient-C5AFRzKB.js";import{C as D,a as z,b as L,d as F,c as J}from"./card-Ks5reE5D.js";import{S as c}from"./skeleton-DM5AfKIJ.js";import{F as W}from"./filter-Cad13wRG.js";import{A as X}from"./award-DAs12a83.js";import{u as Z}from"./mobile-DDjMNcjN.js";import{T as ee,a as T,b as E}from"./tabs-kHd3UHHY.js";import{S as se}from"./scrollable-tabs-De-o2eb7.js";import{C as te,g as ae}from"./challengeService-BX7-uLBl.js";import{P as V}from"./Confetti-EdMnZRZX.js";import{T as re}from"./timer-CaAfZ7c4.js";import"./index-CjjoUzqA.js";import"./Combination-C0y2sNL0.js";import"./Logo-HzuToWv5.js";import"./input-DlubX1PJ.js";import"./label-BLnSVJrc.js";import"./checkbox-9RmuQjIw.js";import"./index-Cs8e_-Nm.js";import"./radio-group-Sl-6f1Ib.js";import"./index-DgvYHQCl.js";import"./chevron-left-CyC_tzUw.js";import"./chevron-right-CoqZHP9k.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=R("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),ie=({userId:f})=>{const[Y,M]=m.useState([]),[h,p]=m.useState([]),[U,j]=m.useState(!0),[d,n]=m.useState("all");m.useEffect(()=>{(async()=>{try{j(!0);const{data:l,error:o}=await S.from("nutrition_quests").select("*, id, title:title, description, points, difficulty, category, icon, active").eq("active",!0);if(o)throw o;const u=l.map(a=>({id:a.id,title:a.title,description:a.description,points:a.points,difficulty:a.difficulty,category:a.category,icon:a.icon||"award",active:a.active}));M(u);const{data:t,error:i}=await S.from("user_nutrition_quests").select("*, quest:quest_id(*)").eq("user_id",f);if(i)throw i;const r=t.map(a=>{var v,b,w,_,C,q,k,B;return{id:a.id,user_id:a.user_id,challenge_id:a.quest_id,status:a.completed?"completed":"in_progress",started_at:a.started_at,completed_at:a.completed_at,challenge:{id:(v=a.quest)==null?void 0:v.id,title:(b=a.quest)==null?void 0:b.title,description:(w=a.quest)==null?void 0:w.description,points:(_=a.quest)==null?void 0:_.points,difficulty:(C=a.quest)==null?void 0:C.difficulty,category:(q=a.quest)==null?void 0:q.category,icon:((k=a.quest)==null?void 0:k.icon)||"award",active:(B=a.quest)==null?void 0:B.active}}});p(r)}catch(l){console.error("Error fetching challenges:",l),P.error("Failed to load challenges")}finally{j(!1)}})()},[f]);const H=async s=>{try{const{data:l,error:o}=await S.from("user_nutrition_quests").insert({user_id:f,quest_id:s,completed:!1}).select().single();if(o)throw o;P.success("Challenge accepted!");const{data:u,error:t}=await S.from("user_nutrition_quests").select("*, quest:quest_id(*)").eq("user_id",f);if(t)throw t;const i=u.map(r=>{var a,v,b,w,_,C,q,k;return{id:r.id,user_id:r.user_id,challenge_id:r.quest_id,status:r.completed?"completed":"in_progress",started_at:r.started_at,completed_at:r.completed_at,challenge:{id:(a=r.quest)==null?void 0:a.id,title:(v=r.quest)==null?void 0:v.title,description:(b=r.quest)==null?void 0:b.description,points:(w=r.quest)==null?void 0:w.points,difficulty:(_=r.quest)==null?void 0:_.difficulty,category:(C=r.quest)==null?void 0:C.category,icon:((q=r.quest)==null?void 0:q.icon)||"award",active:(k=r.quest)==null?void 0:k.active}}});p(i)}catch(l){console.error("Error accepting challenge:",l),P.error("Failed to accept challenge")}},g=s=>h.some(l=>l.challenge_id===s&&l.status!=="failed"),y=s=>{switch(s.toLowerCase()){case"easy":return"bg-green-500";case"medium":return"bg-yellow-500";case"hard":return"bg-red-500";default:return"bg-blue-500"}},N=Y.filter(s=>d==="all"?!0:s.difficulty===d||s.category===d);return U?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center mb-6",children:[e.jsx(c,{className:"h-10 w-32"}),e.jsx(c,{className:"h-10 w-32"}),e.jsx(c,{className:"h-10 w-32"}),e.jsx(c,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(c,{className:"h-64 w-full"}),e.jsx(c,{className:"h-64 w-full"}),e.jsx(c,{className:"h-64 w-full"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(x,{onClick:()=>n("all"),variant:d==="all"?"default":"outline",size:"sm",className:"rounded-full",children:"All Challenges"}),e.jsx(x,{onClick:()=>n("easy"),variant:d==="easy"?"default":"outline",size:"sm",className:"rounded-full",children:"Easy"}),e.jsx(x,{onClick:()=>n("medium"),variant:d==="medium"?"default":"outline",size:"sm",className:"rounded-full",children:"Medium"}),e.jsx(x,{onClick:()=>n("hard"),variant:d==="hard"?"default":"outline",size:"sm",className:"rounded-full",children:"Hard"}),e.jsx(x,{onClick:()=>n("daily"),variant:d==="daily"?"default":"outline",size:"sm",className:"rounded-full",children:"Daily"}),e.jsx(x,{onClick:()=>n("nutrition"),variant:d==="nutrition"?"default":"outline",size:"sm",className:"rounded-full",children:"Nutrition"})]}),N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-2",children:"No challenges found with the selected filter."}),e.jsx(x,{onClick:()=>n("all"),children:"Show All Challenges"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(s=>e.jsxs(D,{className:"overflow-hidden",children:[e.jsx(z,{className:`p-4 ${y(s.difficulty)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(L,{className:"text-lg font-bold text-white",children:s.title}),e.jsx("span",{className:"text-2xl text-white",children:e.jsx(X,{className:"h-6 w-6"})})]})}),e.jsxs(F,{className:"p-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs(A,{variant:"outline",className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:[s.points," points"]}),e.jsx(A,{variant:"outline",className:"bg-blue-100 text-blue-800 border-blue-200 capitalize",children:s.category})]}),e.jsx(x,{onClick:()=>H(s.id),disabled:g(s.id),className:"w-full",variant:g(s.id)?"outline":"default",children:g(s.id)?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"mr-2 h-4 w-4"}),"Challenge Accepted"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Accept Challenge"]})})]})]},s.id))}),h.filter(s=>s.status==="in_progress").length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Your Active Challenges"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.filter(s=>s.status==="in_progress").map(s=>{var l,o,u;return e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-blue-500"}),(l=s.challenge)==null?void 0:l.title]})}),e.jsxs(F,{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:(o=s.challenge)==null?void 0:o.description}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Started: ",new Date(s.started_at).toLocaleDateString()]}),e.jsxs(A,{children:[(u=s.challenge)==null?void 0:u.points," points"]})]})]})]},s.id)})})]})]})},Ee=()=>{const{isMobile:f,isTablet:Y}=Z(),[M,h]=m.useState("active"),[p,U]=m.useState(null),[j,d]=m.useState([]),[n,H]=m.useState([]),[g,y]=m.useState(!0);m.useEffect(()=>{(async()=>{try{y(!0);const{data:i}=await S.auth.getSession();if(!i.session){y(!1);return}U(i.session.user.id);const r=await ae(i.session.user.id);d(r.challenges||[]),H(r.progress||[])}catch(i){console.error("Error fetching challenges:",i),P.error("Failed to load challenges")}finally{y(!1)}})()},[]);const N=j.filter(t=>{const i=n.find(r=>r.challenge_id===t.id);return i&&i.days_completed<i.total_days}),s=j.filter(t=>{const i=n.find(r=>r.challenge_id===t.id);return i&&i.days_completed>=i.total_days}),l=t=>{const i=n.find(r=>r.challenge_id===t);return i?Math.round(i.days_completed/i.total_days*100):0},o=t=>t<=2?"bg-green-100 text-green-800":t<=4?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",u=t=>t<=2?"Easy":t<=4?"Medium":"Hard";return e.jsxs("div",{className:"flex flex-col md:flex-row min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(K,{activePage:"Challenges"}),e.jsxs("div",{className:`flex-1 p-4 sm:p-6 md:p-8 ${f?"":"md:ml-64"} overflow-auto`,children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6",children:"Nutrition Challenges"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 sm:mb-8",children:"Complete challenges to earn points and improve your nutrition habits."}),e.jsxs(ee,{value:M,onValueChange:h,className:"w-full",children:[e.jsxs(se,{className:"mb-6",children:[e.jsx(T,{value:"active",children:"Active Challenges"}),e.jsx(T,{value:"completed",children:"Completed"}),e.jsx(T,{value:"create",children:"Create Challenge"}),e.jsx(T,{value:"explore",children:"Explore"})]}),e.jsx(E,{value:"active",children:g?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(c,{className:"h-48 w-full"}),e.jsx(c,{className:"h-48 w-full"}),e.jsx(c,{className:"h-48 w-full"})]}):N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"You don't have any active challenges."}),e.jsx(x,{onClick:()=>h("create"),children:"Create Your First Challenge"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(t=>e.jsxs(D,{children:[e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(L,{className:"text-lg",children:t.name}),e.jsx(A,{className:o(t.difficulty_level),children:u(t.difficulty_level)})]}),e.jsx(J,{children:t.types.join(", ")})]}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l(t.id),"%"]})]}),e.jsx(V,{value:l(t.id),className:"h-2"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.duration_days," days"]})]})]})})]},t.id))})}),e.jsx(E,{value:"completed",children:g?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(c,{className:"h-48 w-full"}),e.jsx(c,{className:"h-48 w-full"})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"You haven't completed any challenges yet."}),e.jsx(x,{onClick:()=>h("active"),children:"View Active Challenges"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs(D,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsxs(z,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(L,{className:"text-lg flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-2 text-green-600 dark:text-green-400"}),t.name]}),e.jsx(A,{className:o(t.difficulty_level),children:u(t.difficulty_level)})]}),e.jsx(J,{children:t.types.join(", ")})]}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Completed"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"100%"})]}),e.jsx(V,{value:100,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsxs("span",{children:["Completed ",t.duration_days,"-day challenge"]})]})]})})]},t.id))})}),e.jsx(E,{value:"create",children:e.jsx(Q,{})}),e.jsx(E,{value:"explore",children:p?e.jsx(ie,{userId:p}):e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Please log in to explore challenges."})})]})]})]})};export{Ee as default};
