import{r,j as e}from"./index-wx0cpdQ-.js";import{s as y}from"./SupabaseClient-C5AFRzKB.js";import{g as a}from"./gamificationService-BuSNgWxG.js";import{P as j}from"./ProfileSidebar-CUX9nyIG.js";import{u as N}from"./mobile-DDjMNcjN.js";import"./index-CjjoUzqA.js";import"./Combination-C0y2sNL0.js";import"./Logo-HzuToWv5.js";const w=({userId:l})=>{const[d,i]=r.useState([]),[o,c]=r.useState([]),[x,f]=r.useState(1),[g,p]=r.useState(!0);r.useEffect(()=>{l&&(async()=>{try{p(!0);const[s,m,u]=await Promise.all([a.getLevelBenefits(l),a.getUserLevelBenefits(l),a.getUserPoints(l)]);i(s),c(m),f(u.current_level)}catch(s){console.error("Error fetching level benefits:",s)}finally{p(!1)}})()},[l]);const n=async t=>{try{const s=await a.unlockLevelBenefit(l,t);c([...o,s])}catch(s){console.error("Error unlocking benefit:",s),alert("Could not unlock benefit. "+s.message)}},h=async t=>{try{await a.getLevelBenefits(l,t);const s=await a.getUserLevelBenefits(l);c(s)}catch(s){console.error("Error using benefit:",s),alert("Could not use benefit. "+s.message)}},b=t=>o.some(s=>s.level_benefit_id===t&&s.status==="unlocked"),v=t=>o.some(s=>s.level_benefit_id===t&&s.status==="used");return g?e.jsx("div",{className:"p-4 text-center",children:"Loading level benefits..."}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Level Benefits"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Your current level: ",e.jsx("span",{className:"font-semibold",children:x})]}),e.jsxs("div",{className:"space-y-4",children:[d.map(t=>{const s=b(t.id),m=v(t.id),u=x>=t.level_required;return e.jsx("div",{className:`border rounded-lg p-4 transition-all ${s?"border-green-500 bg-green-50":m?"border-gray-300 bg-gray-50 opacity-70":u?"border-blue-500 bg-blue-50":"border-gray-300"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:t.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Required level:"," ",e.jsx("span",{className:"font-medium",children:t.level_required})]}),t.benefit_data.points_cost&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Cost:"," ",e.jsxs("span",{className:"font-medium",children:[t.benefit_data.points_cost," points"]})]})]}),e.jsx("div",{children:m?e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-xs",children:"Used"}):s?e.jsx("button",{onClick:()=>h(t.id),className:"px-3 py-1 bg-green-600 text-white rounded-full text-xs hover:bg-green-700 transition-colors",children:"Use Benefit"}):u?e.jsx("button",{onClick:()=>n(t.id),className:"px-3 py-1 bg-blue-600 text-white rounded-full text-xs hover:bg-blue-700 transition-colors",children:"Unlock"}):e.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-xs",children:"Locked"})})]})},t.id)}),d.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No level benefits available yet."})]})]})},C=()=>{const[l,d]=r.useState(null),[i,o]=r.useState(null),[c,x]=r.useState(!0),{isMobile:f,isTablet:g}=N();return r.useEffect(()=>{(async()=>{try{const{data:{user:n}}=await y.auth.getUser();if(n){d(n.id);const h=await a.getUserPoints(n.id);o(h)}}catch(n){console.error("Error fetching user data:",n)}finally{x(!1)}})()},[]),c?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):l?e.jsxs("div",{className:"flex flex-col md:flex-row min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(j,{activePage:"Level Benefits"}),e.jsxs("div",{className:`flex-1 p-4 sm:p-6 md:p-8 ${f?"":"md:ml-64"}`,children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6",children:"Level Benefits"}),i&&e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-4 sm:p-6 mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold",children:["Level ",i.level]}),e.jsxs("p",{className:"opacity-90",children:[i.points_to_next_level," points to next level"]})]}),e.jsxs("div",{className:"text-right mt-2 sm:mt-0",children:[e.jsx("p",{className:"text-2xl sm:text-3xl font-bold",children:i.total_points}),e.jsx("p",{className:"opacity-90",children:"Total Points"})]})]})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 sm:mb-8",children:"As you level up in the app, you'll unlock special benefits and features. Use your points and level status to access premium content and special offers."}),e.jsx(w,{userId:l})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded",children:e.jsx("p",{children:"Please log in to view your level benefits."})})})};export{C as default};
