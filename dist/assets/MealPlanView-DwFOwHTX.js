import{e as M,u as A,f as E,d as S,r as o,j as e,B as t}from"./index-wx0cpdQ-.js";import{u as q,A as u}from"./useQuery-fXxgk7Us.js";import{C as v,d as y,a as z,b as B,c as F}from"./card-Ks5reE5D.js";import{r as I,e as T}from"./mealService-nWoNWhtW.js";import{g as D}from"./authService-CKYxqK-5.js";import{P as x}from"./ProfileSidebar-CUX9nyIG.js";import{A as O}from"./AddToMealPlanDialog-Bo0LErG5.js";import{T as Q}from"./trash-2-Cdi4lUr4.js";import"./SupabaseClient-C5AFRzKB.js";import"./index-CjjoUzqA.js";import"./Combination-C0y2sNL0.js";import"./Logo-HzuToWv5.js";import"./dialog-iH9WTBjz.js";import"./input-DlubX1PJ.js";import"./select-Dvj3AB60.js";import"./index-Cs8e_-Nm.js";import"./chevron-down-ChOtW655.js";import"./plus-Ci3g5hd-.js";import"./search-C5ZZVUmr.js";const ie=()=>{const{planId:l}=M(),n=A(),p=E(),{toast:c}=S(),[g,j]=o.useState(null);o.useEffect(()=>{(async()=>{try{const a=await D();j(!!a),a||(c({title:"Authentication Required",description:"You must be logged in to view meal plans",variant:"destructive"}),n("/login"))}catch(a){console.error("Error checking authentication:",a),j(!1)}})()},[n,c]);const{data:r,isLoading:N,error:w}=q({queryKey:["mealPlan",l],queryFn:()=>l?T(l):null,enabled:!!l&&g===!0,retry:1}),[m,b]=o.useState({});o.useEffect(()=>{if(r&&r.mealPlanItems){const s={};r.mealPlanItems.forEach(a=>{s[a.day_of_week]||(s[a.day_of_week]={}),s[a.day_of_week][a.meal_time]||(s[a.day_of_week][a.meal_time]=[]),s[a.day_of_week][a.meal_time].push(a)}),b(s)}},[r]);const k=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],_=["Breakfast","Lunch","Dinner","Snack"],P=async s=>{try{await I(s),p.invalidateQueries({queryKey:["mealPlan",l]}),c({title:"Success",description:"Meal removed from plan"})}catch(a){c({title:"Error",description:"Failed to remove meal from plan: "+(a.message||"Unknown error"),variant:"destructive"})}},C=()=>{l&&p.invalidateQueries({queryKey:["mealPlan",l]})};return g===null||N?e.jsxs("div",{className:"page-container",children:[e.jsx(x,{}),e.jsxs("div",{className:"content-area",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(t,{variant:"outline",size:"icon",onClick:()=>n("/meal-planning"),children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx("div",{className:"h-6 w-48 bg-gray-200 rounded animate-pulse"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-10 w-3/4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid gap-6",children:[...Array(7)].map((s,a)=>e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("div",{className:"h-6 w-24 bg-gray-200 rounded animate-pulse mb-4"}),e.jsx("div",{className:"grid gap-4",children:[...Array(3)].map((h,d)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},d))})]},a))})]})]})]}):w||!r?e.jsxs("div",{className:"page-container",children:[e.jsx(x,{}),e.jsxs("div",{className:"content-area",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(t,{variant:"outline",size:"icon",onClick:()=>n("/meal-planning"),children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Error"})]}),e.jsx(v,{children:e.jsxs(y,{className:"pt-6",children:[e.jsx("p",{children:"Failed to load meal plan. Please try again later."}),e.jsx(t,{variant:"default",className:"mt-4",onClick:()=>n("/meal-planning"),children:"Back to Meal Planning"})]})})]})]}):e.jsxs("div",{className:"page-container",children:[e.jsx(x,{}),e.jsxs("div",{className:"content-area",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{variant:"outline",size:"icon",onClick:()=>n("/meal-planning"),children:e.jsx(u,{className:"h-4 w-4"})}),e.jsx("h1",{className:"text-2xl font-bold",children:r==null?void 0:r.mealPlan.name})]}),e.jsx(t,{variant:"outline",onClick:()=>n("/meal-planning"),children:"Back to Meal Plans"})]}),(r==null?void 0:r.mealPlan.description)&&e.jsx("p",{className:"text-gray-600 mb-6",children:r.mealPlan.description}),e.jsx("div",{className:"space-y-8",children:k.map(s=>e.jsxs(v,{className:m[s]?void 0:"opacity-60",children:[e.jsxs(z,{children:[e.jsx(B,{children:s}),!m[s]&&e.jsx(F,{children:"No meals planned for this day"})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-6",children:_.map(a=>{var h,d;return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(d=(h=m[s])==null?void 0:h[a])==null?void 0:d.map(i=>{var f;return e.jsxs("div",{className:"border rounded-md overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"h-28 bg-gray-100 relative",children:(f=i.meal)!=null&&f.image_url?e.jsx("img",{src:i.meal.image_url||"/placeholder.svg",alt:i.meal.meal_name,className:"w-full h-full object-cover",onClick:()=>n(`/meals/${i.meal.id}`)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100 text-gray-400",children:"No Image"})}),e.jsxs("div",{className:"p-3 flex justify-between items-center dark:text-gray-100",children:[e.jsx("div",{children:e.jsx("h4",{className:"font-medium truncate",children:i.meal.meal_name})}),e.jsx(t,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>P(i.id),children:e.jsx(Q,{className:"h-4 w-4"})})]})]},i.id)}),l&&e.jsx(O,{planId:l,dayOfWeek:s,mealTime:a,onMealAdded:C})]})]},a)})})})]},s))})]})]})};export{ie as default};
